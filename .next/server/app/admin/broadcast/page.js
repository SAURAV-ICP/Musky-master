(()=>{var e={};e.id=519,e.ids=[519],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},1808:e=>{"use strict";e.exports=require("net")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},4404:e=>{"use strict";e.exports=require("tls")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},9796:e=>{"use strict";e.exports=require("zlib")},298:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>d,routeModule:()=>m,tree:()=>c});var r=s(482),a=s(9108),n=s(2563),i=s.n(n),o=s(8300),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);s.d(t,l);let c=["",{children:["admin",{children:["broadcast",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,1407)),"/Users/sauravlamichhane/Downloads/Musky-master/src/app/admin/broadcast/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,1342)),"/Users/sauravlamichhane/Downloads/Musky-master/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,9361,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/sauravlamichhane/Downloads/Musky-master/src/app/admin/broadcast/page.tsx"],u="/admin/broadcast/page",p={require:s,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/admin/broadcast/page",pathname:"/admin/broadcast",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},4345:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,2583,23)),Promise.resolve().then(s.t.bind(s,6840,23)),Promise.resolve().then(s.t.bind(s,8771,23)),Promise.resolve().then(s.t.bind(s,3225,23)),Promise.resolve().then(s.t.bind(s,9295,23)),Promise.resolve().then(s.t.bind(s,3982,23))},8189:(e,t,s)=>{Promise.resolve().then(s.bind(s,7282))},5978:(e,t,s)=>{Promise.resolve().then(s.bind(s,2736))},7282:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var r=s(5344),a=s(3729),n=s(8110),i=s(4573),o=s(4212),l=s(8428),c=s(4669);function d(){let{user:e}=(0,o.a)(),t=(0,l.useRouter)(),[s,d]=(0,a.useState)("inbot"),[u,p]=(0,a.useState)(""),[m,x]=(0,a.useState)(""),[b,h]=(0,a.useState)([]),[g,f]=(0,a.useState)(!1),[y,v]=(0,a.useState)({image:"",buttonText:"",buttonUrl:""});(0,a.useEffect)(()=>{e&&!e.is_admin&&t.push("/")},[e,t]);let j=e=>{h(b.filter((t,s)=>s!==e))},w=(e,t,s)=>{let r=[...b];r[e]={...r[e],[t]:s},h(r)},_=async()=>{try{if(!e?.user_id){c.Am.error("You must be logged in to send broadcasts");return}if("inbot"===s){if(!u.trim()){c.Am.error("Message is required for in-bot broadcasts");return}let t=b.filter(e=>e.text&&e.url);if(!(await fetch("/api/admin/broadcast",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({admin_id:e.user_id,type:"inbot",message:u.trim(),image_url:m.trim()||void 0,inline_markup:t.length>0?{buttons:t}:void 0})})).ok)throw Error("Failed to send in-bot broadcast");c.Am.success("In-bot broadcast sent successfully"),p(""),x(""),h([])}else{let{image:t,buttonText:s,buttonUrl:r}=y;if(!t||!s||!r){c.Am.error("Image, button text, and button URL are required for in-app broadcasts");return}if(!(await fetch("/api/admin/broadcast",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({admin_id:e.user_id,type:"inapp",image:t,button_text:s,button_url:r})})).ok)throw Error("Failed to send in-app broadcast");c.Am.success("In-app broadcast created successfully"),v({image:"",buttonText:"",buttonUrl:""})}}catch(e){console.error("Broadcast error:",e),c.Am.error("Failed to send broadcast")}};return e&&e.is_admin?r.jsx(i.Z,{children:(0,r.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[r.jsx("h1",{className:"text-2xl font-bold mb-8",children:"Broadcast Manager"}),(0,r.jsxs)("div",{className:"flex space-x-4 mb-8",children:[r.jsx("button",{onClick:()=>d("inbot"),className:`px-6 py-3 rounded-lg font-semibold ${"inbot"===s?"bg-accent":"bg-black/20"}`,children:"In-Bot Broadcast"}),r.jsx("button",{onClick:()=>d("inapp"),className:`px-6 py-3 rounded-lg font-semibold ${"inapp"===s?"bg-accent":"bg-black/20"}`,children:"In-App Broadcast"})]}),"inbot"===s?(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Message"}),r.jsx("div",{className:"flex items-center space-x-4 mb-2",children:r.jsx("button",{onClick:()=>f(!g),className:`px-3 py-1 rounded ${g?"bg-accent":"bg-black/20"}`,children:"B"})}),r.jsx("textarea",{value:u,onChange:e=>p(e.target.value),className:"w-full bg-black/20 rounded-lg p-4 min-h-[100px]",placeholder:"Enter your broadcast message..."})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Image URL (optional)"}),r.jsx("input",{type:"text",value:m,onChange:e=>x(e.target.value),className:"w-full bg-black/20 rounded-lg p-4",placeholder:"Enter image URL..."})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[r.jsx("label",{className:"text-sm font-semibold",children:"Inline Buttons"}),r.jsx("button",{onClick:()=>{h([...b,{text:"",url:""}])},className:"px-3 py-1 rounded bg-accent text-sm",children:"Add Button"})]}),r.jsx("div",{className:"space-y-4",children:b.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[r.jsx("input",{type:"text",value:e.text,onChange:e=>w(t,"text",e.target.value),className:"flex-1 bg-black/20 rounded-lg p-4",placeholder:"Button text..."}),r.jsx("input",{type:"text",value:e.url,onChange:e=>w(t,"url",e.target.value),className:"flex-1 bg-black/20 rounded-lg p-4",placeholder:"Button URL..."}),r.jsx("button",{onClick:()=>j(t),className:"p-2 rounded bg-red-500/20 text-red-400",children:"✕"})]},t))})]})]}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Image URL"}),r.jsx("input",{type:"text",value:y.image,onChange:e=>v({...y,image:e.target.value}),className:"w-full bg-black/20 rounded-lg p-4",placeholder:"Enter image URL..."})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Button Text"}),r.jsx("input",{type:"text",value:y.buttonText,onChange:e=>v({...y,buttonText:e.target.value}),className:"w-full bg-black/20 rounded-lg p-4",placeholder:"Enter button text..."})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Button URL"}),r.jsx("input",{type:"text",value:y.buttonUrl,onChange:e=>v({...y,buttonUrl:e.target.value}),className:"w-full bg-black/20 rounded-lg p-4",placeholder:"Enter button URL..."})]})]}),r.jsx(n.E.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:_,className:"w-full mt-8 py-4 bg-accent rounded-lg font-semibold",children:"inbot"===s?"Send Broadcast":"Create Broadcast"})]})}):null}},2736:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var r=s(5344),a=s(3410),n=s.n(a);s(3824);var i=s(4212),o=s(2607);function l({children:e}){return r.jsx(o.LD,{manifestUrl:"https://musky-mini-app.vercel.app/tonconnect-manifest.json",actionsConfiguration:{twaReturnUrl:"https://musky-mini-app.vercel.app",skipRedirectToWallet:"always"},children:e})}var c=s(4669);function d({children:e}){return(0,r.jsxs)("html",{lang:"en",children:[(0,r.jsxs)("head",{children:[r.jsx("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"}),r.jsx("meta",{name:"HandheldFriendly",content:"true"}),r.jsx("meta",{name:"apple-mobile-web-app-capable",content:"yes"}),r.jsx("meta",{name:"apple-mobile-web-app-status-bar-style",content:"black-translucent"})]}),r.jsx("body",{className:`${n().className} overflow-x-hidden`,children:r.jsx(l,{children:(0,r.jsxs)(i.d,{children:[e,r.jsx(c.x7,{position:"bottom-center"})]})})})]})}},4573:(e,t,s)=>{"use strict";s.d(t,{Z:()=>l});var r=s(5344);s(3729);var a=s(6506),n=s(9410),i=s(8110),o=s(8428);function l({children:e}){let t=(0,o.usePathname)(),s=[{href:"/",label:"Home",icon:"\uD83C\uDFE0"},{href:"/tasks",label:"Tasks",icon:r.jsx(n.default,{src:"/components/assets/TASKS.png",width:24,height:24,alt:"Tasks"})},{href:"/mining",label:"Mining",icon:"⛏️"},{href:"/refer",label:"Refer",icon:"\uD83D\uDC65"},{href:"/earn",label:"Earn",icon:"\uD83D\uDCB0"}];return r.jsx("div",{className:"min-h-screen",children:(0,r.jsxs)(i.E.div,{className:"min-h-screen bg-gradient-to-b from-background-start-rgb to-background-end-rgb",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[r.jsx("main",{className:"container mx-auto px-4 py-8 pb-20",children:r.jsx(i.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:e})}),r.jsx(i.E.nav,{className:"fixed bottom-0 left-0 right-0 bg-white/10 backdrop-blur-lg border-t border-white/20",initial:{y:100},animate:{y:0},transition:{duration:.5},children:r.jsx("div",{className:"container mx-auto px-4",children:r.jsx("div",{className:"flex justify-between items-center py-2",children:s.map(e=>(0,r.jsxs)(a.default,{href:e.href,className:"relative flex flex-col items-center p-2 group",children:[r.jsx(i.E.span,{className:`text-2xl transition-transform duration-200 ${t===e.href?"scale-110":"scale-100"}`,whileHover:{scale:1.1},whileTap:{scale:.9},children:e.icon}),r.jsx("span",{className:`text-xs mt-1 ${t===e.href?"text-white font-bold":"text-white/60"}`,children:e.label}),t===e.href&&r.jsx(i.E.div,{className:"absolute -bottom-2 w-12 h-1 bg-accent rounded-full",layoutId:"activeTab",transition:{type:"spring",bounce:.2}})]},e.href))})})})]})})}},4212:(e,t,s)=>{"use strict";s.d(t,{a:()=>d,d:()=>c});var r=s(5344),a=s(3729),n=s(8862),i=s(8704);let o=(0,a.createContext)({user:null,loading:!1,error:null,mutate:async()=>{}}),l="12345";function c({children:e}){let{data:t,error:s,isLoading:a,mutate:c}=(0,n.ZP)("user",async()=>{try{console.log("Fetching user data...");let{data:e,error:t}=await i.O.from("users").select("*").eq("user_id",l).single();if(console.log("Existing user data:",e),console.log("Fetch error:",t),t){if("PGRST116"===t.code){console.log("User not found, creating new user...");let{data:e,error:t}=await i.O.from("users").insert({user_id:l,balance:0,solana_balance:0,energy:1200,spin_energy:1200,last_spin_energy_reset:new Date().toISOString(),level:"1",is_admin:!1}).select().single();if(t)throw console.error("Error creating new user:",t),t;return console.log("New user created:",e),e}throw t}if(e&&(void 0===e.spin_energy||null===e.spin_energy||0===e.spin_energy)){console.log("Updating user with spin energy...");let{data:e,error:t}=await i.O.from("users").update({spin_energy:1200,last_spin_energy_reset:new Date().toISOString()}).eq("user_id",l).select().single();if(t)throw console.error("Error updating user:",t),t;return console.log("User updated with spin energy:",e),e}if(e.last_spin_energy_reset){let t=new Date(e.last_spin_energy_reset),s=new Date;if((s.getTime()-t.getTime())/36e5>=12){console.log("Resetting spin energy after 12 hours...");let{data:e,error:t}=await i.O.from("users").update({spin_energy:1200,last_spin_energy_reset:s.toISOString()}).eq("user_id",l).select().single();if(t)throw console.error("Error resetting energy:",t),t;return console.log("Energy reset complete:",e),e}}return e}catch(e){throw console.error("Error in user context:",e),e}});return r.jsx(o.Provider,{value:{user:t,loading:a,error:s,mutate:c},children:e})}function d(){return(0,a.useContext)(o)}},8704:(e,t,s)=>{"use strict";s.d(t,{O:()=>i});var r=s(6755);let a="https://pkaooixolhnhdyajwlgw.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBrYW9vaXhvbGhuaGR5YWp3bGd3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzk5NDQzMDEsImV4cCI6MjA1NTUyMDMwMX0.ATOLcUZaP--eojDV0ugG0bujlOkzam0q7A6e9IIKnxY";if(!a||!n)throw Error("Missing Supabase credentials");let i=(0,r.eI)(a,n)},1407:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>n,__esModule:()=>a,default:()=>i});let r=(0,s(6843).createProxy)(String.raw`/Users/sauravlamichhane/Downloads/Musky-master/src/app/admin/broadcast/page.tsx`),{__esModule:a,$$typeof:n}=r,i=r.default},1342:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>n,__esModule:()=>a,default:()=>i});let r=(0,s(6843).createProxy)(String.raw`/Users/sauravlamichhane/Downloads/Musky-master/src/app/layout.tsx`),{__esModule:a,$$typeof:n}=r,i=r.default},3824:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[638,575,139],()=>s(298));module.exports=r})();