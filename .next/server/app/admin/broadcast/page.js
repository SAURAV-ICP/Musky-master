(()=>{var e={};e.id=4519,e.ids=[4519],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},1808:e=>{"use strict";e.exports=require("net")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},4404:e=>{"use strict";e.exports=require("tls")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},9796:e=>{"use strict";e.exports=require("zlib")},298:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>n.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>o,routeModule:()=>x,tree:()=>d});var r=t(482),a=t(9108),i=t(2563),n=t.n(i),c=t(8300),l={};for(let e in c)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>c[e]);t.d(s,l);let d=["",{children:["admin",{children:["broadcast",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,1407)),"/Users/sauravlamichhane/Downloads/Musky-master/src/app/admin/broadcast/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,1342)),"/Users/sauravlamichhane/Downloads/Musky-master/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,9361,23)),"next/dist/client/components/not-found-error"]}],o=["/Users/sauravlamichhane/Downloads/Musky-master/src/app/admin/broadcast/page.tsx"],m="/admin/broadcast/page",u={require:t,loadChunk:()=>Promise.resolve()},x=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/admin/broadcast/page",pathname:"/admin/broadcast",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},8189:(e,s,t)=>{Promise.resolve().then(t.bind(t,7282))},7282:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>o});var r=t(5344),a=t(3729),i=t(8110),n=t(4669),c=t(9607),l=t(4212),d=t(8704);function o(){let{user:e,loading:s}=(0,l.a)(),[t,o]=(0,a.useState)([]),[m,u]=(0,a.useState)(""),[x,p]=(0,a.useState)(""),[g,h]=(0,a.useState)("info"),[b,f]=(0,a.useState)("7"),[v,j]=(0,a.useState)(!1),[y,N]=(0,a.useState)(!1),[w,_]=(0,a.useState)(null);(0,a.useEffect)(()=>{e?.user_id&&e.is_admin&&k()},[e]);let k=async()=>{try{let{data:e,error:s}=await d.O.from("broadcast_messages").select("*").order("created_at",{ascending:!1});if(s)throw s;o(e||[])}catch(e){console.error("Error fetching broadcast messages:",e),n.Am.error("Failed to load broadcast messages")}},q=async()=>{if(!e?.is_admin){n.Am.error("You do not have permission to send broadcast messages");return}if(!m.trim()||!x.trim()){n.Am.error("Please provide both title and content for the message");return}j(!0);try{let s=new Date;s.setDate(s.getDate()+parseInt(b||"7"));let{error:t}=await d.O.from("broadcast_messages").insert({title:m.trim(),content:x.trim(),type:g,active:!0,expires_at:s.toISOString(),created_by:e.user_id});if(t)throw t;u(""),p(""),h("info"),f("7"),await k(),n.Am.success("Broadcast message sent successfully")}catch(e){console.error("Error sending broadcast message:",e),n.Am.error("Failed to send broadcast message")}finally{j(!1)}},A=async(s,t)=>{if(e?.is_admin)try{let{error:e}=await d.O.from("broadcast_messages").update({active:!t}).eq("id",s);if(e)throw e;await k(),n.Am.success(`Message ${t?"deactivated":"activated"} successfully`)}catch(e){console.error("Error toggling message status:",e),n.Am.error("Failed to update message status")}},M=async s=>{if(e?.is_admin){N(!0),_(s);try{let{error:e}=await d.O.from("broadcast_messages").delete().eq("id",s);if(e)throw e;await k(),n.Am.success("Message deleted successfully")}catch(e){console.error("Error deleting message:",e),n.Am.error("Failed to delete message")}finally{N(!1),_(null)}}},P=e=>{let s=new Date(e);return s.toLocaleDateString()+" "+s.toLocaleTimeString()};return s?r.jsx(c.Z,{children:r.jsx("div",{className:"container mx-auto px-4 py-8",children:r.jsx("div",{className:"flex justify-center items-center h-64",children:r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-accent"})})})}):e?.is_admin?r.jsx(c.Z,{children:(0,r.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[r.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Admin Broadcast Messages"}),(0,r.jsxs)("div",{className:"bg-primary-dark rounded-xl p-6 mb-8",children:[r.jsx("h2",{className:"text-xl font-bold mb-4",children:"Send New Broadcast"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-white/60 mb-2",children:"Message Title"}),r.jsx("input",{type:"text",value:m,onChange:e=>u(e.target.value),placeholder:"Enter message title",className:"w-full bg-black/20 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-accent"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-white/60 mb-2",children:"Message Content"}),r.jsx("textarea",{value:x,onChange:e=>p(e.target.value),placeholder:"Enter message content",rows:4,className:"w-full bg-black/20 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-accent"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-white/60 mb-2",children:"Message Type"}),(0,r.jsxs)("select",{value:g,onChange:e=>h(e.target.value),className:"w-full bg-black/20 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-accent",children:[r.jsx("option",{value:"info",children:"Information"}),r.jsx("option",{value:"success",children:"Success"}),r.jsx("option",{value:"warning",children:"Warning"}),r.jsx("option",{value:"error",children:"Error"})]})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-white/60 mb-2",children:"Expiry (Days)"}),r.jsx("input",{type:"number",value:b,onChange:e=>f(e.target.value),min:"1",max:"30",className:"w-full bg-black/20 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-accent"})]})]}),r.jsx("div",{className:"pt-4",children:r.jsx(i.E.button,{className:"px-6 py-3 bg-accent hover:bg-accent/80 rounded-lg font-bold w-full md:w-auto",whileHover:{scale:1.02},whileTap:{scale:.98},disabled:v||!m.trim()||!x.trim(),onClick:q,children:v?(0,r.jsxs)("span",{className:"flex items-center justify-center",children:[r.jsx("span",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2"}),"Sending..."]}):"Send Broadcast Message"})})]})]}),(m||x)&&(0,r.jsxs)("div",{className:"bg-primary-dark rounded-xl p-6 mb-8",children:[r.jsx("h2",{className:"text-xl font-bold mb-4",children:"Message Preview"}),(0,r.jsxs)("div",{className:`p-4 rounded-lg ${"info"===g?"bg-blue-500/20 border border-blue-500/30":"success"===g?"bg-green-500/20 border border-green-500/30":"warning"===g?"bg-orange-500/20 border border-orange-500/30":"bg-red-500/20 border border-red-500/30"}`,children:[r.jsx("h3",{className:`font-bold text-lg ${"info"===g?"text-blue-400":"success"===g?"text-green-400":"warning"===g?"text-orange-400":"text-red-400"}`,children:m||"Message Title"}),r.jsx("p",{className:"mt-2 whitespace-pre-wrap",children:x||"Message content will appear here..."})]})]}),r.jsx("h2",{className:"text-xl font-bold mb-4",children:"Active Broadcasts"}),0===t.filter(e=>e.active).length?r.jsx("div",{className:"bg-primary-dark rounded-xl p-6 text-center mb-8",children:r.jsx("p",{className:"text-white/60",children:"No active broadcast messages"})}):r.jsx("div",{className:"space-y-4 mb-8",children:t.filter(e=>e.active).map(e=>(0,r.jsxs)("div",{className:`bg-primary-dark rounded-xl p-6 ${w===e.id?"border-2 border-accent":""}`,children:[(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx("span",{className:`w-3 h-3 rounded-full mr-2 ${"info"===e.type?"bg-blue-400":"success"===e.type?"bg-green-400":"warning"===e.type?"bg-orange-400":"bg-red-400"}`}),r.jsx("h3",{className:"font-bold text-lg",children:e.title})]}),(0,r.jsxs)("p",{className:"text-white/60 text-sm mt-1",children:["Created: ",P(e.created_at),e.expires_at&&` â€¢ Expires: ${P(e.expires_at)}`]})]}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[r.jsx("button",{className:`px-3 py-1 rounded text-sm font-medium ${e.active?"bg-orange-500/20 text-orange-400 hover:bg-orange-500/30":"bg-green-500/20 text-green-400 hover:bg-green-500/30"}`,onClick:()=>A(e.id,e.active),children:e.active?"Deactivate":"Activate"}),r.jsx("button",{className:"px-3 py-1 bg-red-500/20 text-red-400 hover:bg-red-500/30 rounded text-sm font-medium",onClick:()=>M(e.id),disabled:y&&w===e.id,children:y&&w===e.id?"Deleting...":"Delete"})]})]}),r.jsx("div",{className:"mt-4 whitespace-pre-wrap",children:e.content})]},e.id))}),r.jsx("h2",{className:"text-xl font-bold mb-4",children:"Inactive Broadcasts"}),0===t.filter(e=>!e.active).length?r.jsx("div",{className:"bg-primary-dark rounded-xl p-6 text-center",children:r.jsx("p",{className:"text-white/60",children:"No inactive broadcast messages"})}):r.jsx("div",{className:"space-y-4",children:t.filter(e=>!e.active).map(e=>(0,r.jsxs)("div",{className:`bg-primary-dark rounded-xl p-6 opacity-70 ${w===e.id?"border-2 border-accent":""}`,children:[(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx("span",{className:`w-3 h-3 rounded-full mr-2 ${"info"===e.type?"bg-blue-400/50":"success"===e.type?"bg-green-400/50":"warning"===e.type?"bg-orange-400/50":"bg-red-400/50"}`}),r.jsx("h3",{className:"font-bold text-lg",children:e.title})]}),(0,r.jsxs)("p",{className:"text-white/60 text-sm mt-1",children:["Created: ",P(e.created_at),e.expires_at&&` â€¢ Expired: ${P(e.expires_at)}`]})]}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[r.jsx("button",{className:"px-3 py-1 bg-green-500/20 text-green-400 hover:bg-green-500/30 rounded text-sm font-medium",onClick:()=>A(e.id,e.active),children:"Activate"}),r.jsx("button",{className:"px-3 py-1 bg-red-500/20 text-red-400 hover:bg-red-500/30 rounded text-sm font-medium",onClick:()=>M(e.id),disabled:y&&w===e.id,children:y&&w===e.id?"Deleting...":"Delete"})]})]}),r.jsx("div",{className:"mt-4 whitespace-pre-wrap",children:e.content})]},e.id))})]})}):r.jsx(c.Z,{children:r.jsx("div",{className:"container mx-auto px-4 py-8",children:(0,r.jsxs)("div",{className:"bg-red-500/20 p-6 rounded-xl text-center",children:[r.jsx("h1",{className:"text-2xl font-bold text-red-400 mb-2",children:"Access Denied"}),r.jsx("p",{className:"text-white/60",children:"You do not have permission to access this page."})]})})})}},1407:(e,s,t)=>{"use strict";t.r(s),t.d(s,{$$typeof:()=>i,__esModule:()=>a,default:()=>n});let r=(0,t(6843).createProxy)(String.raw`/Users/sauravlamichhane/Downloads/Musky-master/src/app/admin/broadcast/page.tsx`),{__esModule:a,$$typeof:i}=r,n=r.default}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[1638,8575,8110,3822],()=>t(298));module.exports=r})();