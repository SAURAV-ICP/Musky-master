(()=>{var e={};e.id=9889,e.ids=[9889],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},1808:e=>{"use strict";e.exports=require("net")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},4404:e=>{"use strict";e.exports=require("tls")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},9796:e=>{"use strict";e.exports=require("zlib")},79:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>r.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>o});var a=t(482),l=t(9108),i=t(2563),r=t.n(i),n=t(8300),c={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>n[e]);t.d(s,c);let o=["",{children:["admin",{children:["tasks",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,7969)),"/Users/sauravlamichhane/Downloads/Musky-master/src/app/admin/tasks/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,1342)),"/Users/sauravlamichhane/Downloads/Musky-master/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,9361,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/sauravlamichhane/Downloads/Musky-master/src/app/admin/tasks/page.tsx"],u="/admin/tasks/page",m={require:t,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:l.x.APP_PAGE,page:"/admin/tasks/page",pathname:"/admin/tasks",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},1818:(e,s,t)=>{Promise.resolve().then(t.bind(t,1631))},1631:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>u});var a=t(5344),l=t(3729),i=t(8110),r=t(4573),n=t(4212),c=t(4669),o=t(8428),d=t(8704);function u(){let{user:e}=(0,n.a)(),s=(0,o.useRouter)(),[t,u]=(0,l.useState)([]),[m,p]=(0,l.useState)(!0),[x,h]=(0,l.useState)(!1),[b,g]=(0,l.useState)(null),[k,y]=(0,l.useState)("pending"),[j,f]=(0,l.useState)({title:"",description:"",type:"telegram",link:"",payment_amount:2e3,clicks_wanted:1e3,payment_type:"stars",button_text:"Join"});(0,l.useEffect)(()=>{if(console.log("AdminTasksPage - Initial user state:",{user_id:e?.user_id,is_admin:e?.is_admin,username:e?.username}),e&&!e.is_admin){console.log("Redirecting non-admin user to home"),s.push("/");return}e?.is_admin&&(console.log("Admin user detected, fetching tasks"),w())},[e,k]),(0,l.useEffect)(()=>{if(!e?.is_admin)return;let s=d.O.channel("task_changes").on("postgres_changes",{event:"*",schema:"public",table:"task_submissions"},e=>{console.log("Real-time update:",e),w()}).subscribe();return()=>{d.O.removeChannel(s)}},[e]);let w=async()=>{try{console.log("Fetching tasks...");let{data:e,error:s}=await d.O.from("task_submissions").select("*").eq("status",k).order("created_at",{ascending:!1});if(s)throw s;console.log("Fetched tasks:",e),u(e||[])}catch(e){console.error("Error fetching tasks:",e),c.Am.error("Failed to fetch tasks")}finally{p(!1)}},v=e=>{let{name:s,value:t}=e.target;console.log(`Input changed - ${s}:`,t),f(e=>{let a={...e,[s]:"payment_amount"===s||"clicks_wanted"===s?parseInt(t)||0:t};return console.log("Updated newTask:",a),a})},N=async()=>{console.log("Add Task button clicked"),console.log("Form Values:",j);try{if(!e){console.error("No user found"),c.Am.error("Please log in to add tasks");return}if(!e.is_admin){console.error("User is not admin"),c.Am.error("Only admins can add tasks");return}let s=[];if(j.title.trim()||s.push("Title"),j.description.trim()||s.push("Description"),j.link.trim()||s.push("Link"),s.length>0){console.log("Missing fields:",s),c.Am.error(`Please fill in: ${s.join(", ")}`);return}let t={...j,user_id:e.user_id,status:"approved",clicks_received:0,active:!0,username:e.username||"Admin"};console.log("Attempting to insert task with data:",t);let{data:a,error:l}=await d.O.from("task_submissions").insert(t).select().single();if(l)throw l;c.Am.success("Task added successfully"),h(!1),f({title:"",description:"",type:"telegram",link:"",payment_amount:2e3,clicks_wanted:1e3,payment_type:"stars",button_text:"Join"}),await w()}catch(e){console.error("Error in handleAddTask:",e),c.Am.error("Failed to add task")}},_=async e=>{try{await d.O.from("task_clicks").delete().eq("task_id",e);let{error:s}=await d.O.from("task_submissions").delete().eq("id",e);if(s)throw s;c.Am.success("Task deleted successfully"),w()}catch(e){console.error("Error deleting task:",e),c.Am.error("Failed to delete task")}},T=async(e,s)=>{try{let{error:t}=await d.O.from("task_submissions").update(s).eq("id",e);if(t)throw t;g(null),c.Am.success("Task updated successfully"),w()}catch(e){console.error("Error updating task:",e),c.Am.error("Failed to update task")}},q=async(e,s)=>{try{let{error:t}=await d.O.from("task_submissions").update({status:s}).eq("id",e);if(t)throw t;c.Am.success(`Task ${s}`),w()}catch(e){console.error("Error updating task status:",e),c.Am.error("Failed to update task status")}};return m&&!e?a.jsx(r.Z,{children:a.jsx("div",{className:"flex justify-center items-center min-h-screen",children:a.jsx(i.E.div,{className:"w-12 h-12 border-4 border-accent border-t-transparent rounded-full",animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"}})})}):e&&!e.is_admin?null:a.jsx(r.Z,{children:(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[a.jsx("h1",{className:"text-2xl font-bold",children:"Task Management"}),a.jsx(i.E.button,{whileHover:{scale:1.02},whileTap:{scale:.98},className:"bg-accent px-6 py-2 rounded-lg font-semibold",onClick:()=>h(!0),children:"Add Task"})]}),a.jsx("div",{className:"flex space-x-4 mb-6",children:["pending","approved","rejected"].map(e=>a.jsx("button",{onClick:()=>y(e),className:`px-4 py-2 rounded-lg font-semibold capitalize ${k===e?"bg-accent text-white":"bg-black/20 text-white/60"}`,children:e},e))}),m?a.jsx("div",{className:"flex justify-center",children:a.jsx(i.E.div,{className:"w-12 h-12 border-4 border-accent border-t-transparent rounded-full",animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"}})}):a.jsx("div",{className:"space-y-4",children:t.map(e=>a.jsx(i.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-primary/20 backdrop-blur-lg rounded-xl p-6 border border-white/10",children:b?.id===e.id?(0,a.jsxs)(i.E.div,{className:"space-y-4",initial:{opacity:0},animate:{opacity:1},children:[a.jsx("div",{className:"sticky top-0 bg-primary/20 backdrop-blur-lg p-4 rounded-lg z-10",children:(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold",children:"Edit Task"}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[a.jsx(i.E.button,{whileHover:{scale:1.02},whileTap:{scale:.98},className:"px-4 py-2 bg-accent rounded-lg font-semibold",onClick:()=>T(e.id,b),children:"Save"}),a.jsx(i.E.button,{whileHover:{scale:1.02},whileTap:{scale:.98},className:"px-4 py-2 bg-black/20 rounded-lg font-semibold",onClick:()=>g(null),children:"Cancel"})]})]})}),(0,a.jsxs)("div",{className:"space-y-4 mt-4 max-h-[70vh] overflow-y-auto p-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm text-white/60 mb-2",children:"Title"}),a.jsx("input",{type:"text",value:b.title,onChange:e=>g({...b,title:e.target.value}),className:"w-full bg-black/20 rounded-lg px-4 py-2",placeholder:"Task title"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm text-white/60 mb-2",children:"Description"}),a.jsx("textarea",{value:b.description,onChange:e=>g({...b,description:e.target.value}),className:"w-full bg-black/20 rounded-lg px-4 py-2 min-h-[100px]",placeholder:"Task description"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm text-white/60 mb-2",children:"Link"}),a.jsx("input",{type:"text",value:b.link,onChange:e=>g({...b,link:e.target.value}),className:"w-full bg-black/20 rounded-lg px-4 py-2",placeholder:"Task link"})]})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"text-xl font-semibold",children:e.title}),a.jsx("p",{className:"text-white/60",children:e.description})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:["pending"===k&&(0,a.jsxs)(a.Fragment,{children:[a.jsx(i.E.button,{whileTap:{scale:.95},onClick:()=>q(e.id,"approved"),className:"p-2 rounded-lg bg-green-500/20 text-green-400",children:"✓"}),a.jsx(i.E.button,{whileTap:{scale:.95},onClick:()=>q(e.id,"rejected"),className:"p-2 rounded-lg bg-red-500/20 text-red-400",children:"✕"})]}),a.jsx(i.E.button,{whileTap:{scale:.95},onClick:()=>g(e),className:"p-2 rounded-lg bg-black/20",children:"✏️"}),a.jsx(i.E.button,{whileTap:{scale:.95},onClick:()=>{window.confirm("Are you sure you want to delete this task?")&&_(e.id)},className:"p-2 rounded-lg bg-black/20 text-red-400",children:"\uD83D\uDDD1️"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{className:"bg-black/20 rounded-lg p-3",children:[a.jsx("p",{className:"text-white/60",children:"Type"}),a.jsx("p",{className:"font-semibold capitalize",children:e.type})]}),(0,a.jsxs)("div",{className:"bg-black/20 rounded-lg p-3",children:[a.jsx("p",{className:"text-white/60",children:"Link"}),a.jsx("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"font-semibold text-accent",children:e.link})]}),(0,a.jsxs)("div",{className:"bg-black/20 rounded-lg p-3",children:[a.jsx("p",{className:"text-white/60",children:"Reward"}),(0,a.jsxs)("p",{className:"font-semibold",children:[e.payment_amount," ",e.payment_type]})]}),(0,a.jsxs)("div",{className:"bg-black/20 rounded-lg p-3",children:[a.jsx("p",{className:"text-white/60",children:"Clicks"}),(0,a.jsxs)("p",{className:"font-semibold",children:[e.clicks_received," / ",e.clicks_wanted]})]})]})]})},e.id))}),x&&a.jsx(i.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:(0,a.jsxs)(i.E.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},className:"bg-primary/20 backdrop-blur-lg rounded-xl p-6 w-full max-w-lg border border-white/10",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[a.jsx("h3",{className:"text-xl font-bold",children:"Add New Task"}),a.jsx("button",{onClick:()=>h(!1),className:"text-white/60 hover:text-white",children:"✕"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm text-white/60 mb-2",children:"Title"}),a.jsx("input",{type:"text",value:j.title,onChange:e=>v(e),name:"title",className:"w-full bg-black/20 rounded-lg px-4 py-2",placeholder:"Task title"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm text-white/60 mb-2",children:"Description"}),a.jsx("textarea",{value:j.description,onChange:e=>v(e),name:"description",className:"w-full bg-black/20 rounded-lg px-4 py-2 min-h-[100px]",placeholder:"Task description"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm text-white/60 mb-2",children:"Type"}),(0,a.jsxs)("select",{value:j.type,onChange:e=>v(e),name:"type",className:"w-full bg-black/20 rounded-lg px-4 py-2",children:[a.jsx("option",{value:"telegram",children:"Telegram"}),a.jsx("option",{value:"youtube",children:"YouTube"}),a.jsx("option",{value:"twitter",children:"Twitter"})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm text-white/60 mb-2",children:"Link"}),a.jsx("input",{type:"text",value:j.link,onChange:e=>v(e),name:"link",className:"w-full bg-black/20 rounded-lg px-4 py-2",placeholder:"Task link"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm text-white/60 mb-2",children:"Clicks Wanted"}),a.jsx("input",{type:"number",value:j.clicks_wanted,onChange:e=>v(e),name:"clicks_wanted",className:"w-full bg-black/20 rounded-lg px-4 py-2",placeholder:"Required clicks"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm text-white/60 mb-2",children:"Payment Amount"}),a.jsx("input",{type:"number",value:j.payment_amount,onChange:e=>v(e),name:"payment_amount",className:"w-full bg-black/20 rounded-lg px-4 py-2",placeholder:"Reward amount"})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm text-white/60 mb-2",children:"Button Text"}),a.jsx("input",{type:"text",value:j.button_text,onChange:e=>v(e),name:"button_text",className:"w-full bg-black/20 rounded-lg px-4 py-2",placeholder:"Button text"})]})]}),(0,a.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[a.jsx(i.E.button,{whileTap:{scale:.95},onClick:()=>h(!1),className:"px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20",children:"Cancel"}),a.jsx(i.E.button,{whileTap:{scale:.95},onClick:N,className:"px-4 py-2 rounded-lg bg-accent hover:bg-accent/80",children:"Add Task"})]})]})})]})})}},7969:(e,s,t)=>{"use strict";t.r(s),t.d(s,{$$typeof:()=>i,__esModule:()=>l,default:()=>r});let a=(0,t(6843).createProxy)(String.raw`/Users/sauravlamichhane/Downloads/Musky-master/src/app/admin/tasks/page.tsx`),{__esModule:l,$$typeof:i}=a,r=a.default}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[1638,8575,8110,7822,9657],()=>t(79));module.exports=a})();