(()=>{var e={};e.id=889,e.ids=[889],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},1808:e=>{"use strict";e.exports=require("net")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},4404:e=>{"use strict";e.exports=require("tls")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},9796:e=>{"use strict";e.exports=require("zlib")},79:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>c});var a=s(482),r=s(9108),n=s(2563),i=s.n(n),l=s(8300),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);s.d(t,o);let c=["",{children:["admin",{children:["tasks",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,7969)),"/Users/sauravlamichhane/Downloads/Musky-master/src/app/admin/tasks/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,1342)),"/Users/sauravlamichhane/Downloads/Musky-master/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,9361,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/sauravlamichhane/Downloads/Musky-master/src/app/admin/tasks/page.tsx"],u="/admin/tasks/page",m={require:s,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/admin/tasks/page",pathname:"/admin/tasks",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},4345:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,2583,23)),Promise.resolve().then(s.t.bind(s,6840,23)),Promise.resolve().then(s.t.bind(s,8771,23)),Promise.resolve().then(s.t.bind(s,3225,23)),Promise.resolve().then(s.t.bind(s,9295,23)),Promise.resolve().then(s.t.bind(s,3982,23))},1818:(e,t,s)=>{Promise.resolve().then(s.bind(s,1631))},5978:(e,t,s)=>{Promise.resolve().then(s.bind(s,2736))},1631:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>u});var a=s(5344),r=s(3729),n=s(8110),i=s(4573),l=s(4212),o=s(4669),c=s(8428),d=s(8704);function u(){let{user:e}=(0,l.a)(),t=(0,c.useRouter)(),[s,u]=(0,r.useState)([]),[m,p]=(0,r.useState)(!0),[h,x]=(0,r.useState)(!1),[g,b]=(0,r.useState)(null),[y,k]=(0,r.useState)("pending"),[f,j]=(0,r.useState)({title:"",description:"",type:"telegram",link:"",payment_amount:2e3,clicks_wanted:1e3,payment_type:"stars",button_text:"Join"});(0,r.useEffect)(()=>{if(console.log("AdminTasksPage - Initial user state:",{user_id:e?.user_id,is_admin:e?.is_admin,username:e?.username}),e&&!e.is_admin){console.log("Redirecting non-admin user to home"),t.push("/");return}e?.is_admin&&(console.log("Admin user detected, fetching tasks"),w())},[e,y]),(0,r.useEffect)(()=>{if(!e?.is_admin)return;let t=d.O.channel("task_changes").on("postgres_changes",{event:"*",schema:"public",table:"task_submissions"},e=>{console.log("Real-time update:",e),w()}).subscribe();return()=>{d.O.removeChannel(t)}},[e]);let w=async()=>{try{console.log("Fetching tasks...");let{data:e,error:t}=await d.O.from("task_submissions").select("*").eq("status",y).order("created_at",{ascending:!1});if(t)throw t;console.log("Fetched tasks:",e),u(e||[])}catch(e){console.error("Error fetching tasks:",e),o.Am.error("Failed to fetch tasks")}finally{p(!1)}},v=e=>{let{name:t,value:s}=e.target;console.log(`Input changed - ${t}:`,s),j(e=>{let a={...e,[t]:"payment_amount"===t||"clicks_wanted"===t?parseInt(s)||0:s};return console.log("Updated newTask:",a),a})},_=async()=>{console.log("Add Task button clicked"),console.log("Form Values:",f);try{if(!e){console.error("No user found"),o.Am.error("Please log in to add tasks");return}if(!e.is_admin){console.error("User is not admin"),o.Am.error("Only admins can add tasks");return}let t=[];if(f.title.trim()||t.push("Title"),f.description.trim()||t.push("Description"),f.link.trim()||t.push("Link"),t.length>0){console.log("Missing fields:",t),o.Am.error(`Please fill in: ${t.join(", ")}`);return}let s={...f,user_id:e.user_id,status:"approved",clicks_received:0,active:!0,username:e.username||"Admin"};console.log("Attempting to insert task with data:",s);let{data:a,error:r}=await d.O.from("task_submissions").insert(s).select().single();if(r)throw r;o.Am.success("Task added successfully"),x(!1),j({title:"",description:"",type:"telegram",link:"",payment_amount:2e3,clicks_wanted:1e3,payment_type:"stars",button_text:"Join"}),await w()}catch(e){console.error("Error in handleAddTask:",e),o.Am.error("Failed to add task")}},N=async e=>{try{await d.O.from("task_clicks").delete().eq("task_id",e);let{error:t}=await d.O.from("task_submissions").delete().eq("id",e);if(t)throw t;o.Am.success("Task deleted successfully"),w()}catch(e){console.error("Error deleting task:",e),o.Am.error("Failed to delete task")}},T=async(e,t)=>{try{let{error:s}=await d.O.from("task_submissions").update(t).eq("id",e);if(s)throw s;b(null),o.Am.success("Task updated successfully"),w()}catch(e){console.error("Error updating task:",e),o.Am.error("Failed to update task")}},E=async(e,t)=>{try{let{error:s}=await d.O.from("task_submissions").update({status:t}).eq("id",e);if(s)throw s;o.Am.success(`Task ${t}`),w()}catch(e){console.error("Error updating task status:",e),o.Am.error("Failed to update task status")}};return m&&!e?a.jsx(i.Z,{children:a.jsx("div",{className:"flex justify-center items-center min-h-screen",children:a.jsx(n.E.div,{className:"w-12 h-12 border-4 border-accent border-t-transparent rounded-full",animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"}})})}):e&&!e.is_admin?null:a.jsx(i.Z,{children:(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[a.jsx("h1",{className:"text-2xl font-bold",children:"Task Management"}),a.jsx(n.E.button,{whileHover:{scale:1.02},whileTap:{scale:.98},className:"bg-accent px-6 py-2 rounded-lg font-semibold",onClick:()=>x(!0),children:"Add Task"})]}),a.jsx("div",{className:"flex space-x-4 mb-6",children:["pending","approved","rejected"].map(e=>a.jsx("button",{onClick:()=>k(e),className:`px-4 py-2 rounded-lg font-semibold capitalize ${y===e?"bg-accent text-white":"bg-black/20 text-white/60"}`,children:e},e))}),m?a.jsx("div",{className:"flex justify-center",children:a.jsx(n.E.div,{className:"w-12 h-12 border-4 border-accent border-t-transparent rounded-full",animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"}})}):a.jsx("div",{className:"space-y-4",children:s.map(e=>a.jsx(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-primary/20 backdrop-blur-lg rounded-xl p-6 border border-white/10",children:g?.id===e.id?(0,a.jsxs)(n.E.div,{className:"space-y-4",initial:{opacity:0},animate:{opacity:1},children:[a.jsx("div",{className:"sticky top-0 bg-primary/20 backdrop-blur-lg p-4 rounded-lg z-10",children:(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold",children:"Edit Task"}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[a.jsx(n.E.button,{whileHover:{scale:1.02},whileTap:{scale:.98},className:"px-4 py-2 bg-accent rounded-lg font-semibold",onClick:()=>T(e.id,g),children:"Save"}),a.jsx(n.E.button,{whileHover:{scale:1.02},whileTap:{scale:.98},className:"px-4 py-2 bg-black/20 rounded-lg font-semibold",onClick:()=>b(null),children:"Cancel"})]})]})}),(0,a.jsxs)("div",{className:"space-y-4 mt-4 max-h-[70vh] overflow-y-auto p-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm text-white/60 mb-2",children:"Title"}),a.jsx("input",{type:"text",value:g.title,onChange:e=>b({...g,title:e.target.value}),className:"w-full bg-black/20 rounded-lg px-4 py-2",placeholder:"Task title"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm text-white/60 mb-2",children:"Description"}),a.jsx("textarea",{value:g.description,onChange:e=>b({...g,description:e.target.value}),className:"w-full bg-black/20 rounded-lg px-4 py-2 min-h-[100px]",placeholder:"Task description"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm text-white/60 mb-2",children:"Link"}),a.jsx("input",{type:"text",value:g.link,onChange:e=>b({...g,link:e.target.value}),className:"w-full bg-black/20 rounded-lg px-4 py-2",placeholder:"Task link"})]})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"text-xl font-semibold",children:e.title}),a.jsx("p",{className:"text-white/60",children:e.description})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:["pending"===y&&(0,a.jsxs)(a.Fragment,{children:[a.jsx(n.E.button,{whileTap:{scale:.95},onClick:()=>E(e.id,"approved"),className:"p-2 rounded-lg bg-green-500/20 text-green-400",children:"✓"}),a.jsx(n.E.button,{whileTap:{scale:.95},onClick:()=>E(e.id,"rejected"),className:"p-2 rounded-lg bg-red-500/20 text-red-400",children:"✕"})]}),a.jsx(n.E.button,{whileTap:{scale:.95},onClick:()=>b(e),className:"p-2 rounded-lg bg-black/20",children:"✏️"}),a.jsx(n.E.button,{whileTap:{scale:.95},onClick:()=>{window.confirm("Are you sure you want to delete this task?")&&N(e.id)},className:"p-2 rounded-lg bg-black/20 text-red-400",children:"\uD83D\uDDD1️"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{className:"bg-black/20 rounded-lg p-3",children:[a.jsx("p",{className:"text-white/60",children:"Type"}),a.jsx("p",{className:"font-semibold capitalize",children:e.type})]}),(0,a.jsxs)("div",{className:"bg-black/20 rounded-lg p-3",children:[a.jsx("p",{className:"text-white/60",children:"Link"}),a.jsx("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"font-semibold text-accent",children:e.link})]}),(0,a.jsxs)("div",{className:"bg-black/20 rounded-lg p-3",children:[a.jsx("p",{className:"text-white/60",children:"Reward"}),(0,a.jsxs)("p",{className:"font-semibold",children:[e.payment_amount," ",e.payment_type]})]}),(0,a.jsxs)("div",{className:"bg-black/20 rounded-lg p-3",children:[a.jsx("p",{className:"text-white/60",children:"Clicks"}),(0,a.jsxs)("p",{className:"font-semibold",children:[e.clicks_received," / ",e.clicks_wanted]})]})]})]})},e.id))}),h&&a.jsx(n.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:(0,a.jsxs)(n.E.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},className:"bg-primary/20 backdrop-blur-lg rounded-xl p-6 w-full max-w-lg border border-white/10",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[a.jsx("h3",{className:"text-xl font-bold",children:"Add New Task"}),a.jsx("button",{onClick:()=>x(!1),className:"text-white/60 hover:text-white",children:"✕"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm text-white/60 mb-2",children:"Title"}),a.jsx("input",{type:"text",value:f.title,onChange:e=>v(e),name:"title",className:"w-full bg-black/20 rounded-lg px-4 py-2",placeholder:"Task title"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm text-white/60 mb-2",children:"Description"}),a.jsx("textarea",{value:f.description,onChange:e=>v(e),name:"description",className:"w-full bg-black/20 rounded-lg px-4 py-2 min-h-[100px]",placeholder:"Task description"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm text-white/60 mb-2",children:"Type"}),(0,a.jsxs)("select",{value:f.type,onChange:e=>v(e),name:"type",className:"w-full bg-black/20 rounded-lg px-4 py-2",children:[a.jsx("option",{value:"telegram",children:"Telegram"}),a.jsx("option",{value:"youtube",children:"YouTube"}),a.jsx("option",{value:"twitter",children:"Twitter"})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm text-white/60 mb-2",children:"Link"}),a.jsx("input",{type:"text",value:f.link,onChange:e=>v(e),name:"link",className:"w-full bg-black/20 rounded-lg px-4 py-2",placeholder:"Task link"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm text-white/60 mb-2",children:"Clicks Wanted"}),a.jsx("input",{type:"number",value:f.clicks_wanted,onChange:e=>v(e),name:"clicks_wanted",className:"w-full bg-black/20 rounded-lg px-4 py-2",placeholder:"Required clicks"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm text-white/60 mb-2",children:"Payment Amount"}),a.jsx("input",{type:"number",value:f.payment_amount,onChange:e=>v(e),name:"payment_amount",className:"w-full bg-black/20 rounded-lg px-4 py-2",placeholder:"Reward amount"})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm text-white/60 mb-2",children:"Button Text"}),a.jsx("input",{type:"text",value:f.button_text,onChange:e=>v(e),name:"button_text",className:"w-full bg-black/20 rounded-lg px-4 py-2",placeholder:"Button text"})]})]}),(0,a.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[a.jsx(n.E.button,{whileTap:{scale:.95},onClick:()=>x(!1),className:"px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20",children:"Cancel"}),a.jsx(n.E.button,{whileTap:{scale:.95},onClick:_,className:"px-4 py-2 rounded-lg bg-accent hover:bg-accent/80",children:"Add Task"})]})]})})]})})}},2736:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var a=s(5344),r=s(3410),n=s.n(r);s(3824);var i=s(4212),l=s(2607);function o({children:e}){return a.jsx(l.LD,{manifestUrl:"https://musky-mini-app.vercel.app/tonconnect-manifest.json",actionsConfiguration:{twaReturnUrl:"https://musky-mini-app.vercel.app",skipRedirectToWallet:"always"},children:e})}var c=s(4669);function d({children:e}){return(0,a.jsxs)("html",{lang:"en",children:[(0,a.jsxs)("head",{children:[a.jsx("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"}),a.jsx("meta",{name:"HandheldFriendly",content:"true"}),a.jsx("meta",{name:"apple-mobile-web-app-capable",content:"yes"}),a.jsx("meta",{name:"apple-mobile-web-app-status-bar-style",content:"black-translucent"})]}),a.jsx("body",{className:`${n().className} overflow-x-hidden`,children:a.jsx(o,{children:(0,a.jsxs)(i.d,{children:[e,a.jsx(c.x7,{position:"bottom-center"})]})})})]})}},4573:(e,t,s)=>{"use strict";s.d(t,{Z:()=>o});var a=s(5344);s(3729);var r=s(6506),n=s(9410),i=s(8110),l=s(8428);function o({children:e}){let t=(0,l.usePathname)(),s=[{href:"/",label:"Home",icon:"\uD83C\uDFE0"},{href:"/tasks",label:"Tasks",icon:a.jsx(n.default,{src:"/components/assets/TASKS.png",width:24,height:24,alt:"Tasks"})},{href:"/mining",label:"Mining",icon:"⛏️"},{href:"/refer",label:"Refer",icon:"\uD83D\uDC65"},{href:"/earn",label:"Earn",icon:"\uD83D\uDCB0"}];return a.jsx("div",{className:"min-h-screen",children:(0,a.jsxs)(i.E.div,{className:"min-h-screen bg-gradient-to-b from-background-start-rgb to-background-end-rgb",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[a.jsx("main",{className:"container mx-auto px-4 py-8 pb-20",children:a.jsx(i.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:e})}),a.jsx(i.E.nav,{className:"fixed bottom-0 left-0 right-0 bg-white/10 backdrop-blur-lg border-t border-white/20",initial:{y:100},animate:{y:0},transition:{duration:.5},children:a.jsx("div",{className:"container mx-auto px-4",children:a.jsx("div",{className:"flex justify-between items-center py-2",children:s.map(e=>(0,a.jsxs)(r.default,{href:e.href,className:"relative flex flex-col items-center p-2 group",children:[a.jsx(i.E.span,{className:`text-2xl transition-transform duration-200 ${t===e.href?"scale-110":"scale-100"}`,whileHover:{scale:1.1},whileTap:{scale:.9},children:e.icon}),a.jsx("span",{className:`text-xs mt-1 ${t===e.href?"text-white font-bold":"text-white/60"}`,children:e.label}),t===e.href&&a.jsx(i.E.div,{className:"absolute -bottom-2 w-12 h-1 bg-accent rounded-full",layoutId:"activeTab",transition:{type:"spring",bounce:.2}})]},e.href))})})})]})})}},4212:(e,t,s)=>{"use strict";s.d(t,{a:()=>d,d:()=>c});var a=s(5344),r=s(3729),n=s(8862),i=s(8704);let l=(0,r.createContext)({user:null,loading:!1,error:null,mutate:async()=>{}}),o="12345";function c({children:e}){let{data:t,error:s,isLoading:r,mutate:c}=(0,n.ZP)("user",async()=>{try{console.log("Fetching user data...");let{data:e,error:t}=await i.O.from("users").select("*").eq("user_id",o).single();if(console.log("Existing user data:",e),console.log("Fetch error:",t),t){if("PGRST116"===t.code){console.log("User not found, creating new user...");let{data:e,error:t}=await i.O.from("users").insert({user_id:o,balance:0,solana_balance:0,energy:1200,spin_energy:1200,last_spin_energy_reset:new Date().toISOString(),level:"1",is_admin:!1}).select().single();if(t)throw console.error("Error creating new user:",t),t;return console.log("New user created:",e),e}throw t}if(e&&(void 0===e.spin_energy||null===e.spin_energy||0===e.spin_energy)){console.log("Updating user with spin energy...");let{data:e,error:t}=await i.O.from("users").update({spin_energy:1200,last_spin_energy_reset:new Date().toISOString()}).eq("user_id",o).select().single();if(t)throw console.error("Error updating user:",t),t;return console.log("User updated with spin energy:",e),e}if(e.last_spin_energy_reset){let t=new Date(e.last_spin_energy_reset),s=new Date;if((s.getTime()-t.getTime())/36e5>=12){console.log("Resetting spin energy after 12 hours...");let{data:e,error:t}=await i.O.from("users").update({spin_energy:1200,last_spin_energy_reset:s.toISOString()}).eq("user_id",o).select().single();if(t)throw console.error("Error resetting energy:",t),t;return console.log("Energy reset complete:",e),e}}return e}catch(e){throw console.error("Error in user context:",e),e}});return a.jsx(l.Provider,{value:{user:t,loading:r,error:s,mutate:c},children:e})}function d(){return(0,r.useContext)(l)}},8704:(e,t,s)=>{"use strict";s.d(t,{O:()=>i});var a=s(6755);let r="https://pkaooixolhnhdyajwlgw.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBrYW9vaXhvbGhuaGR5YWp3bGd3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzk5NDQzMDEsImV4cCI6MjA1NTUyMDMwMX0.ATOLcUZaP--eojDV0ugG0bujlOkzam0q7A6e9IIKnxY";if(!r||!n)throw Error("Missing Supabase credentials");let i=(0,a.eI)(r,n)},7969:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>n,__esModule:()=>r,default:()=>i});let a=(0,s(6843).createProxy)(String.raw`/Users/sauravlamichhane/Downloads/Musky-master/src/app/admin/tasks/page.tsx`),{__esModule:r,$$typeof:n}=a,i=a.default},1342:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>n,__esModule:()=>r,default:()=>i});let a=(0,s(6843).createProxy)(String.raw`/Users/sauravlamichhane/Downloads/Musky-master/src/app/layout.tsx`),{__esModule:r,$$typeof:n}=a,i=a.default},3824:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[638,575,139],()=>s(79));module.exports=a})();