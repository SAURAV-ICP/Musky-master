(()=>{var e={};e.id=8555,e.ids=[8555],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},1808:e=>{"use strict";e.exports=require("net")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},4404:e=>{"use strict";e.exports=require("tls")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},9796:e=>{"use strict";e.exports=require("zlib")},9587:(e,s,a)=>{"use strict";a.r(s),a.d(s,{GlobalError:()=>i.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>o,routeModule:()=>x,tree:()=>c});var t=a(482),r=a(9108),n=a(2563),i=a.n(n),l=a(8300),d={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);a.d(s,d);let c=["",{children:["staking",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,4736)),"/Users/sauravlamichhane/Downloads/Musky-master/src/app/staking/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,1342)),"/Users/sauravlamichhane/Downloads/Musky-master/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,9361,23)),"next/dist/client/components/not-found-error"]}],o=["/Users/sauravlamichhane/Downloads/Musky-master/src/app/staking/page.tsx"],m="/staking/page",u={require:a,loadChunk:()=>Promise.resolve()},x=new t.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/staking/page",pathname:"/staking",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},6312:(e,s,a)=>{Promise.resolve().then(a.bind(a,9353))},9353:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>u});var t=a(5344),r=a(3729),n=a(8110),i=a(3644),l=a(4669),d=a(9607),c=a(4212),o=a(8704);let m=[{id:1,name:"Starter",duration:7,apy:5,minAmount:1e3,earlyWithdrawalFee:20,color:"from-blue-500 to-blue-600",icon:"\uD83D\uDD39"},{id:2,name:"Growth",duration:30,apy:12,minAmount:5e3,earlyWithdrawalFee:15,color:"from-purple-500 to-purple-600",icon:"\uD83D\uDCA0"},{id:3,name:"Premium",duration:90,apy:25,minAmount:2e4,earlyWithdrawalFee:10,color:"from-orange-500 to-orange-600",icon:"\uD83D\uDD36"},{id:4,name:"Diamond",duration:180,apy:40,minAmount:5e4,earlyWithdrawalFee:5,color:"from-accent to-blue-400",icon:"\uD83D\uDC8E"}];function u(){let{user:e,loading:s,mutate:a}=(0,c.a)(),[u,x]=(0,r.useState)([]),[h,p]=(0,r.useState)(null),[b,f]=(0,r.useState)(""),[j,g]=(0,r.useState)(!1),[w,y]=(0,r.useState)(!1),[N,v]=(0,r.useState)(!1),[k,S]=(0,r.useState)(null);(0,r.useEffect)(()=>{e?.user_id&&_()},[e]);let _=async()=>{if(e?.user_id)try{let{data:s,error:a}=await o.O.from("staking_positions").select("*").eq("user_id",e.user_id).order("created_at",{ascending:!1});if(a)throw a;x(s||[])}catch(e){console.error("Error fetching staking positions:",e),l.ZP.error("Failed to load your staking positions")}},M=async()=>{if(!e||!h)return;let s=parseInt(b);if(isNaN(s)||s<h.minAmount){l.ZP.error(`Minimum stake amount is ${h.minAmount} MUSKY`);return}if(s>e.balance){l.ZP.error("Insufficient MUSKY balance");return}g(!0);try{let t=new Date,r=new Date(t);r.setDate(r.getDate()+h.duration);let{error:n}=await o.O.from("staking_positions").insert({user_id:e.user_id,plan_id:h.id,amount:s,start_date:t.toISOString(),end_date:r.toISOString(),claimed:!1});if(n)throw n;let{error:i}=await o.O.from("users").update({balance:e.balance-s}).eq("user_id",e.user_id);if(i)throw i;await a(),await _(),l.ZP.success(`Successfully staked ${s} MUSKY for ${h.duration} days`),p(null),f("")}catch(e){console.error("Error staking MUSKY:",e),l.ZP.error("Failed to stake MUSKY. Please try again.")}finally{g(!1)}},D=async e=>{S(e),v(!0)},P=async()=>{if(e&&k){y(!0);try{let s=new Date,t=new Date(k.end_date),r=m.find(e=>e.id===k.plan_id);if(!r)throw Error("Staking plan not found");let n=k.amount;if(s<t){let e=n*r.earlyWithdrawalFee/100;n-=e,(0,l.ZP)(`Early withdrawal fee of ${r.earlyWithdrawalFee}% applied`)}else{let e=r.duration,s=r.apy/365/100,a=k.amount*s*e;n+=a}let{error:i}=await o.O.from("users").update({balance:e.balance+n}).eq("user_id",e.user_id);if(i)throw i;let{error:d}=await o.O.from("staking_positions").delete().eq("id",k.id);if(d)throw d;await a(),await _(),l.ZP.success(`Successfully withdrawn ${n.toFixed(0)} MUSKY`)}catch(e){console.error("Error withdrawing stake:",e),l.ZP.error("Failed to withdraw. Please try again.")}finally{y(!1),v(!1),S(null)}}},Y=e=>{let s=m.find(s=>s.id===e.plan_id);if(!s)return 0;e.start_date;let a=new Date(e.end_date);if(new Date<a){let a=s.apy/365/100;return e.amount*a*s.duration}{let a=s.apy/365/100;return e.amount*a*s.duration}},U=e=>{let s=new Date(e),a=new Date,t=s.getTime()-a.getTime();return t<=0?"Matured":`${Math.floor(t/864e5)}d ${Math.floor(t%864e5/36e5)}h`},q=e=>e.toLocaleString(void 0,{maximumFractionDigits:0});return s?t.jsx(d.Z,{children:t.jsx("div",{className:"container mx-auto px-4 py-8",children:t.jsx("div",{className:"flex justify-center items-center h-64",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-accent"})})})}):t.jsx(d.Z,{children:(0,t.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,t.jsxs)("div",{children:[t.jsx("h1",{className:"text-2xl font-bold",children:"MUSKY Staking"}),t.jsx("p",{className:"text-white/60",children:"Lock your MUSKY tokens to earn rewards"})]}),(0,t.jsxs)("div",{className:"bg-primary-dark p-3 rounded-xl",children:[t.jsx("p",{className:"text-sm text-white/60",children:"Your Balance"}),(0,t.jsxs)("p",{className:"text-xl font-bold",children:[q(e?.balance||0)," MUSKY"]})]})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:m.map(s=>(0,t.jsxs)(n.E.div,{className:`bg-primary-dark rounded-xl overflow-hidden border-2 ${h?.id===s.id?"border-accent":"border-transparent"}`,whileHover:{scale:1.02},onClick:()=>p(s),children:[(0,t.jsxs)("div",{className:`bg-gradient-to-r ${s.color} p-4`,children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[t.jsx("h3",{className:"text-xl font-bold",children:s.name}),t.jsx("span",{className:"text-2xl",children:s.icon})]}),(0,t.jsxs)("p",{className:"text-3xl font-bold mt-2",children:[s.apy,"% APY"]})]}),(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsxs)("div",{className:"flex justify-between mb-2",children:[t.jsx("span",{className:"text-white/60",children:"Lock Period"}),(0,t.jsxs)("span",{className:"font-medium",children:[s.duration," days"]})]}),(0,t.jsxs)("div",{className:"flex justify-between mb-2",children:[t.jsx("span",{className:"text-white/60",children:"Min. Stake"}),(0,t.jsxs)("span",{className:"font-medium",children:[q(s.minAmount)," MUSKY"]})]}),(0,t.jsxs)("div",{className:"flex justify-between mb-4",children:[t.jsx("span",{className:"text-white/60",children:"Early Fee"}),(0,t.jsxs)("span",{className:"font-medium",children:[s.earlyWithdrawalFee,"%"]})]}),t.jsx("button",{className:`w-full py-2 rounded-lg font-bold ${e?.balance&&e.balance>=s.minAmount?"bg-accent hover:bg-accent/80":"bg-gray-500 cursor-not-allowed"}`,disabled:!e?.balance||e.balance<s.minAmount,children:"Select Plan"})]})]},s.id))}),h&&(0,t.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-primary-dark rounded-xl p-6 mb-8",children:[t.jsx("h2",{className:"text-xl font-bold mb-4",children:"Stake MUSKY Tokens"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"text-lg font-semibold mb-2",children:["Selected Plan: ",h.name]}),(0,t.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-white/60",children:"APY"}),(0,t.jsxs)("span",{className:"font-medium",children:[h.apy,"%"]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-white/60",children:"Lock Period"}),(0,t.jsxs)("span",{className:"font-medium",children:[h.duration," days"]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-white/60",children:"Minimum Stake"}),(0,t.jsxs)("span",{className:"font-medium",children:[q(h.minAmount)," MUSKY"]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-white/60",children:"Early Withdrawal Fee"}),(0,t.jsxs)("span",{className:"font-medium",children:[h.earlyWithdrawalFee,"%"]})]})]}),t.jsx("button",{className:"text-sm text-accent underline",onClick:()=>p(null),children:"Change Plan"})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-white/60 mb-2",children:"Amount to Stake"}),(0,t.jsxs)("div",{className:"relative",children:[t.jsx("input",{type:"number",value:b,onChange:e=>f(e.target.value),placeholder:`Min ${h.minAmount} MUSKY`,className:"w-full bg-black/20 rounded-lg p-3 pr-24 focus:outline-none focus:ring-2 focus:ring-accent"}),t.jsx("button",{className:"absolute right-2 top-2 bg-black/30 text-white/80 px-3 py-1 rounded text-sm",onClick:()=>e?.balance&&f(e.balance.toString()),children:"MAX"})]})]}),b&&!isNaN(parseInt(b))&&(0,t.jsxs)("div",{className:"bg-black/20 rounded-lg p-4 mb-4",children:[t.jsx("h4",{className:"font-medium mb-2",children:"Reward Projection"}),(0,t.jsxs)("div",{className:"flex justify-between mb-1",children:[t.jsx("span",{className:"text-white/60",children:"Principal"}),(0,t.jsxs)("span",{children:[q(parseInt(b))," MUSKY"]})]}),(0,t.jsxs)("div",{className:"flex justify-between mb-1",children:[t.jsx("span",{className:"text-white/60",children:"Estimated Reward"}),(0,t.jsxs)("span",{className:"text-green-400",children:["+",q(parseInt(b)*(h.apy/100)*(h.duration/365))," MUSKY"]})]}),(0,t.jsxs)("div",{className:"flex justify-between pt-2 border-t border-white/10 mt-2",children:[t.jsx("span",{className:"text-white/60",children:"Total Return"}),(0,t.jsxs)("span",{className:"font-bold",children:[q(parseInt(b)+parseInt(b)*(h.apy/100)*(h.duration/365))," MUSKY"]})]})]}),t.jsx("button",{className:`w-full py-3 rounded-lg font-bold ${j||!b||parseInt(b)<h.minAmount||parseInt(b)>(e?.balance||0)?"bg-gray-500 cursor-not-allowed":"bg-accent hover:bg-accent/80"}`,disabled:j||!b||parseInt(b)<h.minAmount||parseInt(b)>(e?.balance||0),onClick:M,children:j?(0,t.jsxs)("span",{className:"flex items-center justify-center",children:[t.jsx("span",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2"}),"Staking..."]}):"Stake MUSKY"})]})]})]}),t.jsx("h2",{className:"text-xl font-bold mb-4",children:"Your Staking Positions"}),0===u.length?(0,t.jsxs)("div",{className:"bg-primary-dark rounded-xl p-6 text-center",children:[t.jsx("p",{className:"text-white/60 mb-2",children:"You don't have any active staking positions"}),t.jsx("p",{className:"text-sm",children:"Select a plan above to start earning rewards"})]}):t.jsx("div",{className:"space-y-4",children:u.map(e=>{let s=m.find(s=>s.id===e.plan_id);if(!s)return null;let a=new Date>=new Date(e.end_date),r=Y(e);return(0,t.jsxs)(n.E.div,{className:"bg-primary-dark rounded-xl overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[t.jsx("div",{className:`bg-gradient-to-r ${s.color} p-4`,children:(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("h3",{className:"text-lg font-bold",children:[s.name," Plan"]}),t.jsx("div",{className:"bg-black/20 px-3 py-1 rounded-full",children:t.jsx("p",{className:"text-sm font-medium",children:a?"Matured":`${U(e.end_date)} left`})})]})}),(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[(0,t.jsxs)("div",{children:[t.jsx("p",{className:"text-white/60 text-sm",children:"Staked Amount"}),(0,t.jsxs)("p",{className:"text-xl font-bold",children:[q(e.amount)," MUSKY"]})]}),(0,t.jsxs)("div",{children:[t.jsx("p",{className:"text-white/60 text-sm",children:"Estimated Rewards"}),(0,t.jsxs)("p",{className:"text-xl font-bold text-green-400",children:["+",q(r)," MUSKY"]})]}),(0,t.jsxs)("div",{children:[t.jsx("p",{className:"text-white/60 text-sm",children:"Total Return"}),(0,t.jsxs)("p",{className:"text-xl font-bold",children:[q(e.amount+r)," MUSKY"]})]})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"text-white/60 text-sm",children:["Staked on ",new Date(e.start_date).toLocaleDateString()]}),(0,t.jsxs)("p",{className:"text-white/60 text-sm",children:[a?"Matured on":"Matures on"," ",new Date(e.end_date).toLocaleDateString()]})]}),t.jsx("button",{className:`px-4 py-2 rounded-lg font-bold ${w?"bg-gray-500 cursor-not-allowed":a?"bg-green-500 hover:bg-green-400":"bg-orange-500 hover:bg-orange-400"}`,disabled:w,onClick:()=>D(e),children:w?"Processing...":a?"Claim Rewards":"Withdraw Early"})]})]})]},e.id)})}),t.jsx(i.M,{children:N&&k&&t.jsx(n.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:t.jsx(n.E.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-primary/90 backdrop-blur-xl rounded-2xl w-full max-w-md overflow-hidden",children:(0,t.jsxs)("div",{className:"p-6",children:[t.jsx("h2",{className:"text-xl font-bold mb-4",children:"Confirm Withdrawal"}),new Date<new Date(k.end_date)&&(0,t.jsxs)("div",{className:"bg-orange-500/20 p-4 rounded-lg mb-4",children:[t.jsx("p",{className:"text-orange-400 font-medium mb-2",children:"Early Withdrawal Warning"}),(0,t.jsxs)("p",{className:"text-sm",children:["Your staking position has not matured yet. Withdrawing early will incur a",m.find(e=>e.id===k.plan_id)?.earlyWithdrawalFee,"% fee on your principal."]})]}),(0,t.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-white/60",children:"Staked Amount"}),(0,t.jsxs)("span",{className:"font-medium",children:[q(k.amount)," MUSKY"]})]}),new Date<new Date(k.end_date)?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-white/60",children:"Early Withdrawal Fee"}),(0,t.jsxs)("span",{className:"text-orange-400",children:["-",q(k.amount*(m.find(e=>e.id===k.plan_id)?.earlyWithdrawalFee||0)/100)," MUSKY"]})]}),(0,t.jsxs)("div",{className:"flex justify-between pt-2 border-t border-white/10",children:[t.jsx("span",{className:"text-white/60",children:"You'll Receive"}),(0,t.jsxs)("span",{className:"font-bold",children:[q(k.amount-k.amount*(m.find(e=>e.id===k.plan_id)?.earlyWithdrawalFee||0)/100)," MUSKY"]})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-white/60",children:"Rewards"}),(0,t.jsxs)("span",{className:"text-green-400",children:["+",q(Y(k))," MUSKY"]})]}),(0,t.jsxs)("div",{className:"flex justify-between pt-2 border-t border-white/10",children:[t.jsx("span",{className:"text-white/60",children:"You'll Receive"}),(0,t.jsxs)("span",{className:"font-bold",children:[q(k.amount+Y(k))," MUSKY"]})]})]})]}),(0,t.jsxs)("div",{className:"flex space-x-3",children:[t.jsx("button",{className:"flex-1 py-3 rounded-lg font-bold bg-gray-600 hover:bg-gray-500",onClick:()=>{v(!1),S(null)},children:"Cancel"}),t.jsx("button",{className:"flex-1 py-3 rounded-lg font-bold bg-accent hover:bg-accent/80",onClick:P,children:w?(0,t.jsxs)("span",{className:"flex items-center justify-center",children:[t.jsx("span",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2"}),"Processing..."]}):"Confirm Withdrawal"})]})]})})})})]})})}},4736:(e,s,a)=>{"use strict";a.r(s),a.d(s,{$$typeof:()=>n,__esModule:()=>r,default:()=>i});let t=(0,a(6843).createProxy)(String.raw`/Users/sauravlamichhane/Downloads/Musky-master/src/app/staking/page.tsx`),{__esModule:r,$$typeof:n}=t,i=t.default}};var s=require("../../webpack-runtime.js");s.C(e);var a=e=>s(s.s=e),t=s.X(0,[1638,8575,8110,3822],()=>a(9587));module.exports=t})();