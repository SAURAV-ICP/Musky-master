"use strict";(()=>{var e={};e.id=971,e.ids=[971],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},1808:e=>{e.exports=require("net")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},4404:e=>{e.exports=require("tls")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},9986:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>d,originalPathname:()=>f,patchFetch:()=>I,requestAsyncStorage:()=>y,routeModule:()=>c,serverHooks:()=>h,staticGenerationAsyncStorage:()=>g,staticGenerationBailout:()=>w});var n={};r.r(n),r.d(n,{POST:()=>m});var a=r(5419),s=r(9108),i=r(9678),o=r(8070),u=r(6517);let p=Math.floor(100),l=[{type:"solana",amount:1,weight:1},{type:"solana",amount:.5,weight:10},{type:"solana",amount:.1,weight:100},{type:"musky",amount:1e3,weight:4e3},{type:"musky",amount:2e3,weight:2500},{type:"musky",amount:5e3,weight:1500},{type:"musky",amount:1e4,weight:500},{type:"energy",amount:500,weight:1e3},{type:"solana",amount:.01,weight:389}];async function m(e){try{let{user_id:t}=await e.json();if(!t)return o.Z.json({error:"User ID is required"},{status:400});let{data:r,error:n}=await u.O.from("users").select("*").eq("user_id",t).single();if(n)return o.Z.json({error:"User not found"},{status:404});let a=r.spin_energy||0,s=r.last_spin_energy_reset;if(function(e){if(!e)return!0;let t=new Date(e).getTime();return Date.now()-t>=432e5}(s)||r.is_admin?(a=r.is_admin?1e5:1200,s=new Date().toISOString()):a=function(e,t){if(t)return 1e5;if(!e)return 1200;let r=Date.now(),n=new Date(e).getTime();return Math.min(1200,Math.floor((r-n)/36e5*p))}(s,r.is_admin),a<1e3){let e=new Date(s?new Date(s).getTime()+432e5:Date.now()+432e5);return o.Z.json({error:"Insufficient stamina",spin_energy:a,next_reset:e.toISOString()},{status:400})}let i=function(){let e=Math.random()*l.reduce((e,t)=>e+t.weight,0);for(let t of l){if(e<t.weight)return t;e-=t.weight}return l[l.length-1]}(),m={spin_energy:a-1e3,last_spin_energy_reset:s};"musky"===i.type?m.balance=r.balance+i.amount:"solana"===i.type?m.solana_balance=(r.solana_balance||0)+i.amount:"energy"===i.type&&(m.spin_energy=a-1e3+i.amount);let{data:c,error:y}=await u.O.from("users").update(m).eq("user_id",t).select().single();if(y)throw y;return await u.O.from("spin_history").insert({user_id:t,prize_type:i.type,amount:i.amount,timestamp:new Date().toISOString()}),o.Z.json({success:!0,prize:{type:i.type,amount:i.amount},spin_energy:c.spin_energy,next_reset:new Date(new Date(s).getTime()+432e5).toISOString()})}catch(e){return console.error("Lucky spin error:",e),o.Z.json({error:"Failed to process spin"},{status:500})}}let c=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/lucky-spin/route",pathname:"/api/lucky-spin",filename:"route",bundlePath:"app/api/lucky-spin/route"},resolvedPagePath:"/Users/sauravlamichhane/Downloads/Musky-master/src/app/api/lucky-spin/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:y,staticGenerationAsyncStorage:g,serverHooks:h,headerHooks:d,staticGenerationBailout:w}=c,f="/api/lucky-spin/route";function I(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:g})}},6517:(e,t,r)=>{r.d(t,{O:()=>i});var n=r(7890);let a="https://pkaooixolhnhdyajwlgw.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBrYW9vaXhvbGhuaGR5YWp3bGd3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzk5NDQzMDEsImV4cCI6MjA1NTUyMDMwMX0.ATOLcUZaP--eojDV0ugG0bujlOkzam0q7A6e9IIKnxY";if(!a||!s)throw Error("Missing Supabase credentials");let i=(0,n.eI)(a,s)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[638,159],()=>r(9986));module.exports=n})();