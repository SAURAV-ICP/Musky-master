"use strict";(()=>{var e={};e.id=798,e.ids=[798],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},1808:e=>{e.exports=require("net")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},4404:e=>{e.exports=require("tls")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},1500:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>h,originalPathname:()=>f,patchFetch:()=>x,requestAsyncStorage:()=>m,routeModule:()=>l,serverHooks:()=>g,staticGenerationAsyncStorage:()=>b,staticGenerationBailout:()=>_});var a={};r.r(a),r.d(a,{POST:()=>c});var i=r(5419),o=r(9108),s=r(9678),n=r(8070),u=r(6517);let d=process.env.TELEGRAM_BOT_TOKEN;async function p(e,t,r){try{let{data:a,error:i}=await u.O.from("users").select("telegram_id").not("telegram_id","is",null);if(i)throw i;for(let i of a){if(!i.telegram_id)continue;let a=r?{inline_keyboard:[r.buttons.map(e=>({text:e.text,url:e.url}))]}:void 0;t?await fetch(`https://api.telegram.org/bot${d}/sendPhoto`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:i.telegram_id,photo:t,caption:e,parse_mode:"HTML",reply_markup:a})}):await fetch(`https://api.telegram.org/bot${d}/sendMessage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:i.telegram_id,text:e,parse_mode:"HTML",reply_markup:a})})}return!0}catch(e){return console.error("Error sending Telegram broadcast:",e),!1}}async function c(e){try{let t=await e.json(),{data:r,error:a}=await u.O.from("users").select("is_admin").eq("user_id",t.admin_id).single();if(a||!r?.is_admin)return n.Z.json({error:"Unauthorized"},{status:403});if("inbot"===t.type){if(!t.message)return n.Z.json({error:"Message is required for in-bot broadcast"},{status:400});if(!await p(t.message,t.image_url,t.inline_markup))throw Error("Failed to send Telegram broadcast");await u.O.from("broadcasts").insert({admin_id:t.admin_id,message:t.message,image_url:t.image_url,inline_markup:t.inline_markup,type:"inbot",sent_at:new Date().toISOString()})}else{if(!t.image||!t.button_text||!t.button_url)return n.Z.json({error:"Image, button text, and button URL are required for in-app broadcast"},{status:400});await u.O.from("app_broadcasts").insert({admin_id:t.admin_id,image:t.image,button_text:t.button_text,button_url:t.button_url,active:!0,created_at:new Date().toISOString()})}return n.Z.json({success:!0,message:`${"inbot"===t.type?"In-bot":"In-app"} broadcast sent successfully`})}catch(e){return console.error("Broadcast error:",e),n.Z.json({error:"Failed to send broadcast"},{status:500})}}let l=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/admin/broadcast/route",pathname:"/api/admin/broadcast",filename:"route",bundlePath:"app/api/admin/broadcast/route"},resolvedPagePath:"/Users/sauravlamichhane/Downloads/Musky-master/src/app/api/admin/broadcast/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:b,serverHooks:g,headerHooks:h,staticGenerationBailout:_}=l,f="/api/admin/broadcast/route";function x(){return(0,s.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:b})}},6517:(e,t,r)=>{r.d(t,{O:()=>s});var a=r(7890);let i="https://pkaooixolhnhdyajwlgw.supabase.co",o="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBrYW9vaXhvbGhuaGR5YWp3bGd3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzk5NDQzMDEsImV4cCI6MjA1NTUyMDMwMX0.ATOLcUZaP--eojDV0ugG0bujlOkzam0q7A6e9IIKnxY";if(!i||!o)throw Error("Missing Supabase credentials");let s=(0,a.eI)(i,o)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,159],()=>r(1500));module.exports=a})();