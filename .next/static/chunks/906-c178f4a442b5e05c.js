"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[906],{4775:function(e,a,s){var t=s(3827),n=s(4090),i=s(6790);a.Z=e=>{let{amount:a,currency:s,itemType:r,onSuccess:l,onCancel:c}=e,{user:o,mutate:d}=(0,i.a)(),[m,u]=(0,n.useState)(!1),[h,f]=(0,n.useState)(!1),[x,p]=(0,n.useState)(null),[g,b]=(0,n.useState)("initializing"),y=async()=>{if(!o){p("User not found. Please refresh the page.");return}u(!0),p(null),b("initializing");try{if("TON"===s||"Stars"===s){var e;if(null===(e=window.Telegram)||void 0===e?void 0:e.WebApp)try{if(b("requesting_telegram_payment"),console.log("Requesting ".concat(s," payment of ").concat(a," for ").concat(r)),(await window.Telegram.WebApp.requestPayment({amount:a,currency:"TON"===s?"TON":"STARS"})).success){b("processing_backend"),console.log("Telegram payment successful, processing in backend");let e=await fetch("/api/payments/process",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:o.user_id,amount:a,currency:s,item_type:r})});if(e.ok){let a=await e.json();console.log("Backend processing successful:",a),f(!0),b("completed"),await d(),setTimeout(()=>{l()},1500)}else{let a=await e.json();console.error("Backend processing failed:",a),p(a.error||"Failed to process payment in our system"),b("failed")}}else console.error("Telegram payment was cancelled or failed"),p("Payment was cancelled or failed in Telegram"),b("failed")}catch(e){console.error("Telegram payment error:",e),p("Failed to process Telegram payment. Please try again."),b("failed")}else console.error("Telegram Web App is not available"),p("Telegram Web App is not available. Please open this app in Telegram."),b("failed")}else if("MUSKY"===s){if(b("checking_balance"),console.log("Processing MUSKY payment of ".concat(a," for ").concat(r)),o.balance<a){console.error("Insufficient MUSKY balance"),p("Insufficient MUSKY balance. You have ".concat(o.balance.toLocaleString()," MUSKY, but need ").concat(a.toLocaleString()," MUSKY.")),b("failed");return}b("processing_backend");let e=await fetch("/api/payments/process",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:o.user_id,amount:a,currency:"MUSKY",item_type:r})});if(e.ok){let a=await e.json();console.log("MUSKY payment successful:",a),f(!0),b("completed"),await d(),setTimeout(()=>{l()},1500)}else{let a="Failed to process payment";try{a=(await e.json()).error||a}catch(s){a=await e.text()||a}console.error("MUSKY payment failed:",a),p(a),b("failed")}}}catch(e){console.error("Payment error:",e),p("An unexpected error occurred. Please try again."),b("failed")}finally{u(!1)}};(0,n.useEffect)(()=>{let e=setTimeout(()=>{y()},500);return()=>clearTimeout(e)},[]);let j=(()=>{let e={};return"TON"===s?(e.MUSKY=8e3*a,e.Stars=500*a):"Stars"===s?(e.MUSKY=16*a,e.TON=a/500):"MUSKY"===s&&(e.TON=a/8e3,e.Stars=a/16),e})(),w=()=>{switch(g){case"initializing":return"Initializing payment...";case"requesting_telegram_payment":return"Requesting payment from Telegram...";case"checking_balance":return"Checking your balance...";case"processing_backend":return"Processing your payment...";case"completed":return"Payment successful!";case"failed":return"Payment failed";default:return"Processing..."}};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("h3",{className:"text-xl font-bold mb-2",children:"Processing Payment"}),(0,t.jsx)("p",{className:"text-white/60",children:m?w():h?"Payment successful!":x?"Payment failed":"Paying ".concat(a," ").concat(s," for ").concat(r)})]}),(0,t.jsxs)("div",{className:"bg-black/20 rounded-xl p-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,t.jsx)("span",{className:"text-white/60",children:"Amount:"}),(0,t.jsxs)("span",{className:"font-bold",children:[a.toLocaleString()," ",s]})]}),(0,t.jsxs)("div",{className:"space-y-1 text-sm text-white/60",children:["MUSKY"!==s&&(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Equivalent MUSKY:"}),(0,t.jsxs)("span",{children:[j.MUSKY.toLocaleString()," MUSKY"]})]}),"TON"!==s&&(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Equivalent TON:"}),(0,t.jsxs)("span",{children:[j.TON.toFixed(4)," TON"]})]}),"Stars"!==s&&(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Equivalent Stars:"}),(0,t.jsxs)("span",{children:[j.Stars.toLocaleString()," Stars"]})]})]}),"MUSKY"===s&&o&&(0,t.jsx)("div",{className:"mt-3 pt-3 border-t border-white/10",children:(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-white/60",children:"Your MUSKY Balance:"}),(0,t.jsxs)("span",{className:o.balance>=a?"text-green-400":"text-red-400",children:[o.balance.toLocaleString()," MUSKY"]})]})})]}),(0,t.jsx)("div",{className:"flex justify-center",children:m?(0,t.jsxs)("div",{className:"flex flex-col items-center",children:[(0,t.jsx)("div",{className:"w-12 h-12 border-4 border-t-accent border-white/20 rounded-full animate-spin mb-4"}),(0,t.jsx)("p",{className:"text-white/60",children:w()})]}):h?(0,t.jsxs)("div",{className:"flex flex-col items-center",children:[(0,t.jsx)("div",{className:"w-12 h-12 bg-green-500 rounded-full flex items-center justify-center mb-4",children:(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,t.jsx)("p",{className:"text-green-400",children:"Payment successful!"})]}):x?(0,t.jsxs)("div",{className:"flex flex-col items-center",children:[(0,t.jsx)("div",{className:"w-12 h-12 bg-red-500 rounded-full flex items-center justify-center mb-4",children:(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,t.jsx)("p",{className:"text-red-400 mb-2",children:x}),(0,t.jsx)("button",{onClick:c,className:"px-4 py-2 bg-black/20 rounded-lg hover:bg-black/30 transition-colors",children:"Go Back"})]}):(0,t.jsxs)("div",{className:"flex flex-col items-center",children:[(0,t.jsx)("div",{className:"w-12 h-12 border-4 border-t-accent border-white/20 rounded-full animate-spin mb-4"}),(0,t.jsx)("p",{className:"text-white/60",children:"Initializing payment..."})]})})]})}},7372:function(e,a,s){s.d(a,{Z:function(){return c}});var t=s(3827);s(4090);var n=s(8792),i=s(703),r=s(1840),l=s(7907);function c(e){let{children:a}=e,s=(0,l.usePathname)(),c=[{href:"/",label:"Home",icon:"\uD83C\uDFE0"},{href:"/tasks",label:"Tasks",icon:(0,t.jsx)(i.default,{src:"/components/assets/TASKS.png",width:24,height:24,alt:"Tasks"})},{href:"/mining",label:"Mining",icon:"⛏️"},{href:"/refer",label:"Refer",icon:"\uD83D\uDC65"},{href:"/earn",label:"Earn",icon:"\uD83D\uDCB0"}];return(0,t.jsx)("div",{className:"min-h-screen",children:(0,t.jsxs)(r.E.div,{className:"min-h-screen bg-gradient-to-b from-background-start-rgb to-background-end-rgb",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[(0,t.jsx)("main",{className:"container mx-auto px-4 py-8 pb-20",children:(0,t.jsx)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:a})}),(0,t.jsx)(r.E.nav,{className:"fixed bottom-0 left-0 right-0 bg-white/10 backdrop-blur-lg border-t border-white/20",initial:{y:100},animate:{y:0},transition:{duration:.5},children:(0,t.jsx)("div",{className:"container mx-auto px-4",children:(0,t.jsx)("div",{className:"flex justify-between items-center py-2",children:c.map(e=>(0,t.jsxs)(n.default,{href:e.href,className:"relative flex flex-col items-center p-2 group",children:[(0,t.jsx)(r.E.span,{className:"text-2xl transition-transform duration-200 ".concat(s===e.href?"scale-110":"scale-100"),whileHover:{scale:1.1},whileTap:{scale:.9},children:e.icon}),(0,t.jsx)("span",{className:"text-xs mt-1 ".concat(s===e.href?"text-white font-bold":"text-white/60"),children:e.label}),s===e.href&&(0,t.jsx)(r.E.div,{className:"absolute -bottom-2 w-12 h-1 bg-accent rounded-full",layoutId:"activeTab",transition:{type:"spring",bounce:.2}})]},e.href))})})})]})})}}}]);