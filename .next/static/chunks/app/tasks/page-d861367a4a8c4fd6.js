(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[289],{307:function(e,t,s){Promise.resolve().then(s.bind(s,741))},741:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return p}});var a=s(3827),i=s(4090),r=s(7372),l=s(1840),c=s(6790),n=s(963),d=s(7907),o=s(4958),m=s(1348),x=e=>{let{notifications:t,onDismiss:s}=e;return(0,a.jsx)("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:(0,a.jsx)(m.M,{children:t.map(e=>(0,a.jsx)(l.E.div,{initial:{opacity:0,x:100,scale:.9},animate:{opacity:1,x:0,scale:1},exit:{opacity:0,x:100,scale:.9},className:"bg-black/80 backdrop-blur-lg rounded-lg p-4 shadow-lg border border-white/10 w-80 ".concat("success"===e.type?"border-green-500/50":"error"===e.type?"border-red-500/50":"border-white/10"),children:(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-xl\n                ".concat("success"===e.type?"bg-green-500/20 text-green-400":"error"===e.type?"bg-red-500/20 text-red-400":"bg-primary/30 text-white"),children:"success"===e.type?"✓":"error"===e.type?"✕":"ℹ"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm ".concat("success"===e.type?"text-green-400":"error"===e.type?"text-red-400":"text-white/90"),children:e.message}),e.amount&&"success"===e.type&&(0,a.jsxs)(l.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex items-center space-x-2 mt-1",children:[(0,a.jsx)("span",{className:"text-xs text-white/60",children:"Reward:"}),(0,a.jsxs)(l.E.span,{className:"text-sm font-bold text-green-400",initial:{scale:1},animate:{scale:[1,1.2,1]},transition:{duration:.5},children:["+",e.amount," MUSKY"]})]})]}),(0,a.jsx)("button",{onClick:()=>s(e.id),className:"text-white/60 hover:text-white",children:"✕"})]})},e.id))})})},h=s(703);function p(){let{user:e}=(0,c.a)(),[t,s]=(0,i.useState)([]),[m,p]=(0,i.useState)([]),[u,b]=(0,i.useState)([]),[w,f]=(0,i.useState)({}),[g,y]=(0,i.useState)("available"),j=(0,d.useRouter)();(0,i.useEffect)(()=>{e&&(N(),v())},[e]),(0,i.useEffect)(()=>{let e=o.O.channel("task_notifications").on("broadcast",{event:"task_completed"},e=>{let{type:t,message:s,amount:a}=e.payload,i=Date.now();b(e=>[...e,{id:i.toString(),type:t,message:s,amount:a,timestamp:i}]),setTimeout(()=>{b(e=>e.filter(e=>e.id!==i.toString()))},5e3),N(),v()}).subscribe();return()=>{o.O.removeChannel(e)}},[]);let N=async()=>{if(e)try{let{data:t}=await o.O.from("task_clicks").select("task_id").eq("user_id",e.user_id),a=(null==t?void 0:t.map(e=>e.task_id))||[],{data:i,error:r}=await o.O.from("task_submissions").select("*").eq("status","approved").eq("active",!0).order("created_at",{ascending:!1}).then(e=>{var t;if(e.error)throw e.error;return{data:(null===(t=e.data)||void 0===t?void 0:t.filter(e=>!a.includes(e.id)))||[],error:null}});if(r)throw r;s(i||[])}catch(e){console.error("Error fetching tasks:",e),n.Am.error("Failed to fetch tasks")}},v=async()=>{if(e)try{let{data:t}=await o.O.from("task_clicks").select("task_id").eq("user_id",e.user_id);if(!(null==t?void 0:t.length)){p([]);return}let s=t.map(e=>e.task_id),{data:a,error:i}=await o.O.from("task_submissions").select("*").in("id",s).order("created_at",{ascending:!1});if(i)throw i;p(a||[])}catch(e){console.error("Error fetching completed tasks:",e),n.Am.error("Failed to fetch completed tasks")}},k=async t=>{if(e)try{f(e=>({...e,[t.id]:!0})),window.open(t.link,"_blank"),setTimeout(async()=>{try{let{error:s}=await o.O.from("task_clicks").insert({task_id:t.id,user_id:e.user_id});if(s)throw s;let{data:a,error:i}=await o.O.from("users").select("balance").eq("user_id",e.user_id).single();if(i)throw i;let{error:r}=await o.O.from("users").update({balance:((null==a?void 0:a.balance)||0)+t.payment_amount}).eq("user_id",e.user_id);if(r)throw r;_({id:Date.now().toString(),type:"success",message:"Task completed successfully!",amount:t.payment_amount,timestamp:Date.now()}),N(),v()}catch(e){console.error("Error completing task:",e),_({id:Date.now().toString(),type:"error",message:"Failed to complete task",timestamp:Date.now()})}finally{f(e=>({...e,[t.id]:!1}))}},1e4)}catch(e){console.error("Error handling task:",e),f(e=>({...e,[t.id]:!1}))}},_=e=>{b(t=>[e,...t]),setTimeout(()=>E(e.id),5e3)},E=e=>{b(t=>t.filter(t=>t.id!==e))},C=e=>{switch(e){case"telegram":return"/images/telegram.png";case"youtube":return"/images/youtube.png";case"twitter":return"/images/twitter.png";default:return"/images/link.png"}},D=e=>{switch(e){case"telegram":return"Join";case"youtube":return"Subscribe";case"twitter":return"Follow";default:return"Complete"}};return e?(0,a.jsxs)(r.Z,{children:[(0,a.jsx)(x,{notifications:u,onDismiss:E}),(0,a.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,a.jsx)("div",{className:"flex justify-end mb-6",children:(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsx)("button",{onClick:()=>y("available"),className:"px-6 py-2 rounded-lg font-medium transition-all ".concat("available"===g?"bg-accent text-white shadow-lg shadow-accent/20":"bg-primary/20 text-white/60 hover:bg-primary/30"),children:"Available Tasks"}),(0,a.jsx)("button",{onClick:()=>y("completed"),className:"px-6 py-2 rounded-lg font-medium transition-all ".concat("completed"===g?"bg-accent text-white shadow-lg shadow-accent/20":"bg-primary/20 text-white/60 hover:bg-primary/30"),children:"Completed Tasks"})]})}),(0,a.jsx)("div",{className:"space-y-4",children:"available"===g?t.length>0?t.map(e=>(0,a.jsx)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-primary/20 backdrop-blur-lg rounded-xl p-6 border border-white/10",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(h.default,{src:C(e.type),alt:e.type,width:24,height:24,className:"w-6 h-6"}),(0,a.jsx)("h3",{className:"text-xl font-semibold",children:e.title})]}),(0,a.jsx)("p",{className:"mt-2 text-white/60",children:e.description}),(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsxs)("span",{className:"text-accent text-lg font-semibold",children:["+",e.payment_amount," MUSKY"]})})]}),(0,a.jsx)(l.E.button,{whileHover:{scale:1.02},whileTap:{scale:.98},className:"px-6 py-2 rounded-lg font-semibold ".concat(w[e.id]?"bg-primary/50 cursor-wait":"bg-accent hover:bg-accent/80"),onClick:()=>!w[e.id]&&k(e),disabled:w[e.id],children:w[e.id]?(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(l.E.div,{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full",animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"}}),(0,a.jsx)("span",{children:"Processing..."})]}):D(e.type)})]})},e.id)):(0,a.jsxs)("div",{className:"text-center py-12 text-white/60",children:[(0,a.jsx)("p",{className:"text-6xl mb-4",children:"\uD83C\uDFAF"}),(0,a.jsx)("p",{className:"text-xl",children:"No tasks available right now"}),(0,a.jsx)("p",{className:"mt-2",children:"Check back later for new tasks!"})]}):m.length>0?m.map(e=>(0,a.jsx)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-primary/10 backdrop-blur-lg rounded-xl p-6 border border-white/5",children:(0,a.jsxs)("div",{className:"flex items-start",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(h.default,{src:C(e.type),alt:e.type,width:24,height:24,className:"w-6 h-6"}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-white/60",children:e.title})]}),(0,a.jsx)("p",{className:"mt-2 text-white/40",children:e.description}),(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsxs)("span",{className:"text-green-400 text-lg font-semibold",children:["+",e.payment_amount," MUSKY"]})})]}),(0,a.jsx)("div",{className:"px-4 py-1 rounded-full bg-green-500/20 text-green-400 text-sm font-medium",children:"Completed"})]})},e.id)):(0,a.jsxs)("div",{className:"text-center py-12 text-white/60",children:[(0,a.jsx)("p",{className:"text-6xl mb-4",children:"\uD83D\uDCDD"}),(0,a.jsx)("p",{className:"text-xl",children:"No completed tasks yet"}),(0,a.jsx)("p",{className:"mt-2",children:"Complete some tasks to earn rewards!"})]})}),"available"===g&&(0,a.jsx)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mt-8 p-6 bg-primary/20 backdrop-blur-lg rounded-xl border border-white/10",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-white",children:"Create Your Own Campaign"}),(0,a.jsx)("p",{className:"text-sm text-white/60 mt-1",children:"Launch custom tasks and earn when others complete them"})]}),(0,a.jsx)(l.E.button,{className:"px-6 py-2 bg-accent rounded-lg font-medium text-white shadow-lg shadow-accent/20",whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>j.push("/tasks/marketplace"),children:"Open Marketplace"})]})})]})]}):(0,a.jsx)(r.Z,{children:(0,a.jsx)("div",{className:"max-w-2xl mx-auto px-4 flex items-center justify-center min-h-[400px]",children:(0,a.jsx)("p",{className:"text-white/60",children:"Please log in to view tasks"})})})}}},function(e){e.O(0,[414,965,985,971,69,744],function(){return e(e.s=307)}),_N_E=e.O()}]);