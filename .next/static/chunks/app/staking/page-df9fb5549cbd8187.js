(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[555],{8924:function(){},5024:function(){},2739:function(e,a,t){Promise.resolve().then(t.bind(t,8675))},8675:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return x}});var s=t(3827),n=t(4090),l=t(1840),i=t(1348),r=t(963),c=t(5036),d=t(6790),o=t(4958);let m=[{id:1,name:"Starter",duration:7,apy:5,minAmount:1e3,earlyWithdrawalFee:20,color:"from-blue-500 to-blue-600",icon:"\uD83D\uDD39"},{id:2,name:"Growth",duration:30,apy:12,minAmount:5e3,earlyWithdrawalFee:15,color:"from-purple-500 to-purple-600",icon:"\uD83D\uDCA0"},{id:3,name:"Premium",duration:90,apy:25,minAmount:2e4,earlyWithdrawalFee:10,color:"from-orange-500 to-orange-600",icon:"\uD83D\uDD36"},{id:4,name:"Diamond",duration:180,apy:40,minAmount:5e4,earlyWithdrawalFee:5,color:"from-accent to-blue-400",icon:"\uD83D\uDC8E"}];function x(){var e,a,t;let{user:x,loading:u,mutate:h}=(0,d.a)(),[p,f]=(0,n.useState)([]),[b,j]=(0,n.useState)(null),[g,w]=(0,n.useState)(""),[N,y]=(0,n.useState)(!1),[v,S]=(0,n.useState)(!1),[k,_]=(0,n.useState)(!1),[M,Y]=(0,n.useState)(null);(0,n.useEffect)(()=>{(null==x?void 0:x.user_id)&&D()},[x]);let D=async()=>{if(null==x?void 0:x.user_id)try{let{data:e,error:a}=await o.O.from("staking_positions").select("*").eq("user_id",x.user_id).order("created_at",{ascending:!1});if(a)throw a;f(e||[])}catch(e){console.error("Error fetching staking positions:",e),r.ZP.error("Failed to load your staking positions")}},U=async()=>{if(!x||!b)return;let e=parseInt(g);if(isNaN(e)||e<b.minAmount){r.ZP.error("Minimum stake amount is ".concat(b.minAmount," MUSKY"));return}if(e>x.balance){r.ZP.error("Insufficient MUSKY balance");return}y(!0);try{let a=new Date,t=new Date(a);t.setDate(t.getDate()+b.duration);let{error:s}=await o.O.from("staking_positions").insert({user_id:x.user_id,plan_id:b.id,amount:e,start_date:a.toISOString(),end_date:t.toISOString(),claimed:!1});if(s)throw s;let{error:n}=await o.O.from("users").update({balance:x.balance-e}).eq("user_id",x.user_id);if(n)throw n;await h(),await D(),r.ZP.success("Successfully staked ".concat(e," MUSKY for ").concat(b.duration," days")),j(null),w("")}catch(e){console.error("Error staking MUSKY:",e),r.ZP.error("Failed to stake MUSKY. Please try again.")}finally{y(!1)}},K=async e=>{Y(e),_(!0)},E=async()=>{if(x&&M){S(!0);try{let e=new Date,a=new Date(M.end_date),t=m.find(e=>e.id===M.plan_id);if(!t)throw Error("Staking plan not found");let s=M.amount;if(e<a){let e=s*t.earlyWithdrawalFee/100;s-=e,(0,r.ZP)("Early withdrawal fee of ".concat(t.earlyWithdrawalFee,"% applied"))}else{let e=t.duration,a=t.apy/365/100,n=M.amount*a*e;s+=n}let{error:n}=await o.O.from("users").update({balance:x.balance+s}).eq("user_id",x.user_id);if(n)throw n;let{error:l}=await o.O.from("staking_positions").delete().eq("id",M.id);if(l)throw l;await h(),await D(),r.ZP.success("Successfully withdrawn ".concat(s.toFixed(0)," MUSKY"))}catch(e){console.error("Error withdrawing stake:",e),r.ZP.error("Failed to withdraw. Please try again.")}finally{S(!1),_(!1),Y(null)}}},C=e=>{let a=m.find(a=>a.id===e.plan_id);if(!a)return 0;e.start_date;let t=new Date(e.end_date);if(new Date<t){let t=a.apy/365/100;return e.amount*t*a.duration}{let t=a.apy/365/100;return e.amount*t*a.duration}},P=e=>{let a=new Date(e),t=new Date,s=a.getTime()-t.getTime();return s<=0?"Matured":"".concat(Math.floor(s/864e5),"d ").concat(Math.floor(s%864e5/36e5),"h")},F=e=>e.toLocaleString(void 0,{maximumFractionDigits:0});return u?(0,s.jsx)(c.Z,{children:(0,s.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,s.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-accent"})})})}):(0,s.jsx)(c.Z,{children:(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"MUSKY Staking"}),(0,s.jsx)("p",{className:"text-white/60",children:"Lock your MUSKY tokens to earn rewards"})]}),(0,s.jsxs)("div",{className:"bg-primary-dark p-3 rounded-xl",children:[(0,s.jsx)("p",{className:"text-sm text-white/60",children:"Your Balance"}),(0,s.jsxs)("p",{className:"text-xl font-bold",children:[F((null==x?void 0:x.balance)||0)," MUSKY"]})]})]}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:m.map(e=>(0,s.jsxs)(l.E.div,{className:"bg-primary-dark rounded-xl overflow-hidden border-2 ".concat((null==b?void 0:b.id)===e.id?"border-accent":"border-transparent"),whileHover:{scale:1.02},onClick:()=>j(e),children:[(0,s.jsxs)("div",{className:"bg-gradient-to-r ".concat(e.color," p-4"),children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("h3",{className:"text-xl font-bold",children:e.name}),(0,s.jsx)("span",{className:"text-2xl",children:e.icon})]}),(0,s.jsxs)("p",{className:"text-3xl font-bold mt-2",children:[e.apy,"% APY"]})]}),(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-white/60",children:"Lock Period"}),(0,s.jsxs)("span",{className:"font-medium",children:[e.duration," days"]})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-white/60",children:"Min. Stake"}),(0,s.jsxs)("span",{className:"font-medium",children:[F(e.minAmount)," MUSKY"]})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-4",children:[(0,s.jsx)("span",{className:"text-white/60",children:"Early Fee"}),(0,s.jsxs)("span",{className:"font-medium",children:[e.earlyWithdrawalFee,"%"]})]}),(0,s.jsx)("button",{className:"w-full py-2 rounded-lg font-bold ".concat((null==x?void 0:x.balance)&&x.balance>=e.minAmount?"bg-accent hover:bg-accent/80":"bg-gray-500 cursor-not-allowed"),disabled:!(null==x?void 0:x.balance)||x.balance<e.minAmount,children:"Select Plan"})]})]},e.id))}),b&&(0,s.jsxs)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-primary-dark rounded-xl p-6 mb-8",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Stake MUSKY Tokens"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{className:"text-lg font-semibold mb-2",children:["Selected Plan: ",b.name]}),(0,s.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-white/60",children:"APY"}),(0,s.jsxs)("span",{className:"font-medium",children:[b.apy,"%"]})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-white/60",children:"Lock Period"}),(0,s.jsxs)("span",{className:"font-medium",children:[b.duration," days"]})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-white/60",children:"Minimum Stake"}),(0,s.jsxs)("span",{className:"font-medium",children:[F(b.minAmount)," MUSKY"]})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-white/60",children:"Early Withdrawal Fee"}),(0,s.jsxs)("span",{className:"font-medium",children:[b.earlyWithdrawalFee,"%"]})]})]}),(0,s.jsx)("button",{className:"text-sm text-accent underline",onClick:()=>j(null),children:"Change Plan"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-white/60 mb-2",children:"Amount to Stake"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:"number",value:g,onChange:e=>w(e.target.value),placeholder:"Min ".concat(b.minAmount," MUSKY"),className:"w-full bg-black/20 rounded-lg p-3 pr-24 focus:outline-none focus:ring-2 focus:ring-accent"}),(0,s.jsx)("button",{className:"absolute right-2 top-2 bg-black/30 text-white/80 px-3 py-1 rounded text-sm",onClick:()=>(null==x?void 0:x.balance)&&w(x.balance.toString()),children:"MAX"})]})]}),g&&!isNaN(parseInt(g))&&(0,s.jsxs)("div",{className:"bg-black/20 rounded-lg p-4 mb-4",children:[(0,s.jsx)("h4",{className:"font-medium mb-2",children:"Reward Projection"}),(0,s.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,s.jsx)("span",{className:"text-white/60",children:"Principal"}),(0,s.jsxs)("span",{children:[F(parseInt(g))," MUSKY"]})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,s.jsx)("span",{className:"text-white/60",children:"Estimated Reward"}),(0,s.jsxs)("span",{className:"text-green-400",children:["+",F(parseInt(g)*(b.apy/100)*(b.duration/365))," MUSKY"]})]}),(0,s.jsxs)("div",{className:"flex justify-between pt-2 border-t border-white/10 mt-2",children:[(0,s.jsx)("span",{className:"text-white/60",children:"Total Return"}),(0,s.jsxs)("span",{className:"font-bold",children:[F(parseInt(g)+parseInt(g)*(b.apy/100)*(b.duration/365))," MUSKY"]})]})]}),(0,s.jsx)("button",{className:"w-full py-3 rounded-lg font-bold ".concat(N||!g||parseInt(g)<b.minAmount||parseInt(g)>((null==x?void 0:x.balance)||0)?"bg-gray-500 cursor-not-allowed":"bg-accent hover:bg-accent/80"),disabled:N||!g||parseInt(g)<b.minAmount||parseInt(g)>((null==x?void 0:x.balance)||0),onClick:U,children:N?(0,s.jsxs)("span",{className:"flex items-center justify-center",children:[(0,s.jsx)("span",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2"}),"Staking..."]}):"Stake MUSKY"})]})]})]}),(0,s.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Your Staking Positions"}),0===p.length?(0,s.jsxs)("div",{className:"bg-primary-dark rounded-xl p-6 text-center",children:[(0,s.jsx)("p",{className:"text-white/60 mb-2",children:"You don't have any active staking positions"}),(0,s.jsx)("p",{className:"text-sm",children:"Select a plan above to start earning rewards"})]}):(0,s.jsx)("div",{className:"space-y-4",children:p.map(e=>{let a=m.find(a=>a.id===e.plan_id);if(!a)return null;let t=new Date>=new Date(e.end_date),n=C(e);return(0,s.jsxs)(l.E.div,{className:"bg-primary-dark rounded-xl overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[(0,s.jsx)("div",{className:"bg-gradient-to-r ".concat(a.color," p-4"),children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("h3",{className:"text-lg font-bold",children:[a.name," Plan"]}),(0,s.jsx)("div",{className:"bg-black/20 px-3 py-1 rounded-full",children:(0,s.jsx)("p",{className:"text-sm font-medium",children:t?"Matured":"".concat(P(e.end_date)," left")})})]})}),(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-white/60 text-sm",children:"Staked Amount"}),(0,s.jsxs)("p",{className:"text-xl font-bold",children:[F(e.amount)," MUSKY"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-white/60 text-sm",children:"Estimated Rewards"}),(0,s.jsxs)("p",{className:"text-xl font-bold text-green-400",children:["+",F(n)," MUSKY"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-white/60 text-sm",children:"Total Return"}),(0,s.jsxs)("p",{className:"text-xl font-bold",children:[F(e.amount+n)," MUSKY"]})]})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"text-white/60 text-sm",children:["Staked on ",new Date(e.start_date).toLocaleDateString()]}),(0,s.jsxs)("p",{className:"text-white/60 text-sm",children:[t?"Matured on":"Matures on"," ",new Date(e.end_date).toLocaleDateString()]})]}),(0,s.jsx)("button",{className:"px-4 py-2 rounded-lg font-bold ".concat(v?"bg-gray-500 cursor-not-allowed":t?"bg-green-500 hover:bg-green-400":"bg-orange-500 hover:bg-orange-400"),disabled:v,onClick:()=>K(e),children:v?"Processing...":t?"Claim Rewards":"Withdraw Early"})]})]})]},e.id)})}),(0,s.jsx)(i.M,{children:k&&M&&(0,s.jsx)(l.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:(0,s.jsx)(l.E.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-primary/90 backdrop-blur-xl rounded-2xl w-full max-w-md overflow-hidden",children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Confirm Withdrawal"}),new Date<new Date(M.end_date)&&(0,s.jsxs)("div",{className:"bg-orange-500/20 p-4 rounded-lg mb-4",children:[(0,s.jsx)("p",{className:"text-orange-400 font-medium mb-2",children:"Early Withdrawal Warning"}),(0,s.jsxs)("p",{className:"text-sm",children:["Your staking position has not matured yet. Withdrawing early will incur a",null===(e=m.find(e=>e.id===M.plan_id))||void 0===e?void 0:e.earlyWithdrawalFee,"% fee on your principal."]})]}),(0,s.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-white/60",children:"Staked Amount"}),(0,s.jsxs)("span",{className:"font-medium",children:[F(M.amount)," MUSKY"]})]}),new Date<new Date(M.end_date)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-white/60",children:"Early Withdrawal Fee"}),(0,s.jsxs)("span",{className:"text-orange-400",children:["-",F(M.amount*((null===(a=m.find(e=>e.id===M.plan_id))||void 0===a?void 0:a.earlyWithdrawalFee)||0)/100)," MUSKY"]})]}),(0,s.jsxs)("div",{className:"flex justify-between pt-2 border-t border-white/10",children:[(0,s.jsx)("span",{className:"text-white/60",children:"You'll Receive"}),(0,s.jsxs)("span",{className:"font-bold",children:[F(M.amount-M.amount*((null===(t=m.find(e=>e.id===M.plan_id))||void 0===t?void 0:t.earlyWithdrawalFee)||0)/100)," MUSKY"]})]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-white/60",children:"Rewards"}),(0,s.jsxs)("span",{className:"text-green-400",children:["+",F(C(M))," MUSKY"]})]}),(0,s.jsxs)("div",{className:"flex justify-between pt-2 border-t border-white/10",children:[(0,s.jsx)("span",{className:"text-white/60",children:"You'll Receive"}),(0,s.jsxs)("span",{className:"font-bold",children:[F(M.amount+C(M))," MUSKY"]})]})]})]}),(0,s.jsxs)("div",{className:"flex space-x-3",children:[(0,s.jsx)("button",{className:"flex-1 py-3 rounded-lg font-bold bg-gray-600 hover:bg-gray-500",onClick:()=>{_(!1),Y(null)},children:"Cancel"}),(0,s.jsx)("button",{className:"flex-1 py-3 rounded-lg font-bold bg-accent hover:bg-accent/80",onClick:E,children:v?(0,s.jsxs)("span",{className:"flex items-center justify-center",children:[(0,s.jsx)("span",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2"}),"Processing..."]}):"Confirm Withdrawal"})]})]})})})})]})})}},5036:function(e,a,t){"use strict";t.d(a,{Z:function(){return o}});var s=t(3827),n=t(4090),l=t(6790),i=t(1348),r=t(1840);function c(e){let{minBalance:a=1e3,onClose:t}=e,{user:c}=(0,l.a)(),[d,o]=(0,n.useState)(null),[m,x]=(0,n.useState)(!0);(0,n.useEffect)(()=>{if(!c||c.balance<a){x(!1);return}u()},[c,a]);let u=async()=>{try{let e=await fetch("/api/admin/broadcast/active");if(e.ok){let a=await e.json();a.message?o(a.message):o({id:"default",title:"Your MUSKY Balance",content:"You have ".concat(null==c?void 0:c.balance," MUSKY tokens! Consider staking them to earn more rewards."),type:"info",active:!0,created_at:new Date().toISOString(),expires_at:null})}else o({id:"default",title:"Welcome to MUSKY",content:"Start earning and staking your MUSKY tokens today!",type:"info",active:!0,created_at:new Date().toISOString(),expires_at:null})}catch(e){console.error("Error fetching broadcast message:",e),o({id:"default",title:"Welcome to MUSKY",content:"Start earning and staking your MUSKY tokens today!",type:"info",active:!0,created_at:new Date().toISOString(),expires_at:null})}},h=()=>{x(!1),t&&t()};return m&&d?(0,s.jsx)(i.M,{children:(0,s.jsx)(r.E.div,{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:h,children:(0,s.jsxs)(r.E.div,{className:"bg-gradient-to-br from-blue-800 to-blue-900 rounded-xl shadow-2xl p-6 max-w-md w-full",initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-white",children:d.title}),(0,s.jsx)("button",{onClick:h,className:"text-gray-300 hover:text-white transition-colors",children:"✕"})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("p",{className:"text-gray-200 mb-2",children:d.content}),c&&(0,s.jsx)("div",{className:"bg-blue-700 bg-opacity-30 rounded-lg p-3 mt-3",children:(0,s.jsxs)("p",{className:"text-white font-medium",children:["Current Balance: ",(0,s.jsxs)("span",{className:"font-bold",children:[c.balance," MUSKY"]})]})})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,s.jsx)("button",{onClick:h,className:"px-4 py-2 rounded-lg bg-blue-700 text-white hover:bg-blue-600 transition-colors",children:"Close"}),(0,s.jsx)("button",{onClick:()=>{window.location.href="/staking",h()},className:"px-4 py-2 rounded-lg bg-green-600 text-white hover:bg-green-500 transition-colors",children:"Stake Now"})]})]})})}):null}var d=t(1116);function o(e){let{children:a}=e,{user:t,loading:i}=(0,l.a)(),[r,o]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{if(t&&!i){let e=localStorage.getItem("last_balance_popup_time"),a=new Date().getTime();(!e||a-parseInt(e)>864e5)&&(o(!0),localStorage.setItem("last_balance_popup_time",a.toString()))}},[t,i]),(0,s.jsx)(d.LD,{manifestUrl:"/tonconnect-manifest.json",children:(0,s.jsxs)("div",{className:"flex flex-col min-h-screen bg-gradient-to-b from-blue-900 to-blue-950",children:[(0,s.jsx)("main",{className:"flex-grow container mx-auto px-4 py-8",children:a}),r&&t&&(0,s.jsx)(c,{minBalance:1e3,onClose:()=>{o(!1)}})]})})}}},function(e){e.O(0,[896,840,965,522,548,971,69,744],function(){return e(e.s=2739)}),_N_E=e.O()}]);