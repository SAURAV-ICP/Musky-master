(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[390],{9266:function(e,r,t){Promise.resolve().then(t.bind(t,9267))},9267:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return c}});var s=t(3827),n=t(4090),a=t(1840),l=t(963),i=t(6790),o=t(7372);function c(){let{user:e}=(0,i.a)(),[r,t]=(0,n.useState)(null),[c,d]=(0,n.useState)(!0),u="https://t.me/MUSKY_ON_SOL_BOT";(0,n.useEffect)(()=>{(null==e?void 0:e.user_id)&&m()},[null==e?void 0:e.user_id]);let m=async()=>{if(null==e?void 0:e.user_id)try{d(!0);let r=await fetch("/api/referrals/".concat(e.user_id));if(r.ok){let s=await r.json();s.referralLink="".concat(u,"?start=ref_").concat(e.user_id),t(s)}else throw Error("Failed to fetch referral stats")}catch(e){console.error("Error fetching referral stats:",e),l.Am.error("Failed to load referral data")}finally{d(!1)}};return(0,s.jsx)(o.Z,{children:(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Refer & Earn"}),c?(0,s.jsx)("div",{className:"flex justify-center py-12",children:(0,s.jsxs)("div",{className:"animate-pulse flex space-x-2",children:[(0,s.jsx)("div",{className:"h-3 w-3 bg-accent rounded-full"}),(0,s.jsx)("div",{className:"h-3 w-3 bg-accent rounded-full"}),(0,s.jsx)("div",{className:"h-3 w-3 bg-accent rounded-full"})]})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"bg-primary/20 rounded-xl p-6 mb-6 border border-white/10",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[(0,s.jsxs)("div",{className:"bg-background/30 p-4 rounded-lg text-center",children:[(0,s.jsx)("p",{className:"text-white/60 text-sm mb-1",children:"Total Referrals"}),(0,s.jsx)("p",{className:"text-2xl font-bold",children:(null==r?void 0:r.totalReferrals)||0})]}),(0,s.jsxs)("div",{className:"bg-background/30 p-4 rounded-lg text-center",children:[(0,s.jsx)("p",{className:"text-white/60 text-sm mb-1",children:"Total Earned"}),(0,s.jsxs)("p",{className:"text-2xl font-bold",children:[(null==r?void 0:r.totalEarned)||0," MUSKY"]})]})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("p",{className:"text-white/60 text-sm mb-2",children:"Your Referral Link"}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"text",value:(null==r?void 0:r.referralLink)||"",readOnly:!0,className:"flex-1 bg-background/50 border border-white/10 rounded-l-lg py-2 px-3 text-sm"}),(0,s.jsx)(a.E.button,{className:"bg-accent py-2 px-4 rounded-r-lg text-sm font-medium",whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{(null==r?void 0:r.referralLink)&&navigator.clipboard.writeText(r.referralLink).then(()=>{l.Am.success("Referral link copied to clipboard!")}).catch(()=>{l.Am.error("Failed to copy link")})},children:"Copy"})]})]}),(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsxs)(a.E.button,{className:"flex-1 bg-primary/40 py-3 rounded-lg font-medium flex items-center justify-center space-x-2",whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{if(!(null==r?void 0:r.referralLink))return;let e="https://t.me/share/url?url=".concat(encodeURIComponent(r.referralLink),"&text=").concat(encodeURIComponent("Join me on Musky and earn MUSKY tokens! Use my referral link:"));window.open(e,"_blank")},children:[(0,s.jsx)("span",{children:"\uD83D\uDCF1"}),(0,s.jsx)("span",{children:"Share on Telegram"})]}),(0,s.jsxs)(a.E.button,{className:"flex-1 bg-accent/80 py-3 rounded-lg font-medium flex items-center justify-center space-x-2",whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{if(!(null==e?void 0:e.user_id))return;let r="".concat(u,"?start=ref_").concat(e.user_id);window.open(r,"_blank")},children:[(0,s.jsx)("span",{children:"\uD83E\uDD16"}),(0,s.jsx)("span",{children:"Open Bot"})]})]})]}),(0,s.jsxs)("div",{className:"bg-primary/20 rounded-xl p-6 border border-white/10",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-4",children:"How It Works"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,s.jsx)("div",{className:"w-8 h-8 bg-accent/20 rounded-full flex items-center justify-center flex-shrink-0",children:"1"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:"Share your referral link"}),(0,s.jsx)("p",{className:"text-white/60 text-sm",children:"Send your unique referral link to friends via Telegram"})]})]}),(0,s.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,s.jsx)("div",{className:"w-8 h-8 bg-accent/20 rounded-full flex items-center justify-center flex-shrink-0",children:"2"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:"Friends join $Musky platform"}),(0,s.jsx)("p",{className:"text-white/60 text-sm",children:"When they join using your link, they become your referral, you Get instantly 2000 $MUSKY"})]})]}),(0,s.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,s.jsx)("div",{className:"w-8 h-8 bg-accent/20 rounded-full flex items-center justify-center flex-shrink-0",children:"3"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:"Earn Additional rewards"}),(0,s.jsx)("p",{className:"text-white/60 text-sm",children:"Get 10% of all MUSKY your referrals earn"})]})]})]})]}),(null==r?void 0:r.recentReferrals)&&r.recentReferrals.length>0&&(0,s.jsxs)("div",{className:"bg-primary/20 rounded-xl p-6 mt-6 border border-white/10",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Recent Referrals"}),(0,s.jsx)("div",{className:"space-y-3",children:r.recentReferrals.map((e,r)=>(0,s.jsxs)("div",{className:"bg-background/30 p-3 rounded-lg flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:e.username}),(0,s.jsx)("p",{className:"text-white/60 text-xs",children:e.date})]}),(0,s.jsx)("div",{className:"text-right",children:(0,s.jsxs)("p",{className:"font-bold text-accent",children:["+",e.earned," MUSKY"]})})]},r))})]})]})]})})}},7372:function(e,r,t){"use strict";t.d(r,{Z:function(){return o}});var s=t(3827);t(4090);var n=t(8792),a=t(703),l=t(1840),i=t(7907);function o(e){let{children:r}=e,t=(0,i.usePathname)(),o=[{href:"/",label:"Home",icon:"\uD83C\uDFE0"},{href:"/tasks",label:"Tasks",icon:(0,s.jsx)(a.default,{src:"/components/assets/TASKS.png",width:24,height:24,alt:"Tasks"})},{href:"/mining",label:"Mining",icon:"⛏️"},{href:"/refer",label:"Refer",icon:"\uD83D\uDC65"},{href:"/earn",label:"Earn",icon:"\uD83D\uDCB0"}];return(0,s.jsx)("div",{className:"min-h-screen",children:(0,s.jsxs)(l.E.div,{className:"min-h-screen bg-gradient-to-b from-background-start-rgb to-background-end-rgb",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[(0,s.jsx)("main",{className:"container mx-auto px-4 py-8 pb-20",children:(0,s.jsx)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:r})}),(0,s.jsx)(l.E.nav,{className:"fixed bottom-0 left-0 right-0 bg-white/10 backdrop-blur-lg border-t border-white/20",initial:{y:100},animate:{y:0},transition:{duration:.5},children:(0,s.jsx)("div",{className:"container mx-auto px-4",children:(0,s.jsx)("div",{className:"flex justify-between items-center py-2",children:o.map(e=>(0,s.jsxs)(n.default,{href:e.href,className:"relative flex flex-col items-center p-2 group",children:[(0,s.jsx)(l.E.span,{className:"text-2xl transition-transform duration-200 ".concat(t===e.href?"scale-110":"scale-100"),whileHover:{scale:1.1},whileTap:{scale:.9},children:e.icon}),(0,s.jsx)("span",{className:"text-xs mt-1 ".concat(t===e.href?"text-white font-bold":"text-white/60"),children:e.label}),t===e.href&&(0,s.jsx)(l.E.div,{className:"absolute -bottom-2 w-12 h-1 bg-accent rounded-full",layoutId:"activeTab",transition:{type:"spring",bounce:.2}})]},e.href))})})})]})})}},6790:function(e,r,t){"use strict";t.d(r,{a:function(){return d},d:function(){return c}});var s=t(3827),n=t(4090),a=t(7212),l=t(4958);let i=(0,n.createContext)({user:null,loading:!1,error:null,mutate:async()=>{},updateWalletAddress:async()=>!1}),o="7093793454";function c(e){let{children:r}=e,[t,c]=(0,n.useState)(null);(0,n.useEffect)(()=>{let e=(()=>{try{if(console.log("Attempting to get Telegram user ID..."),window.Telegram){console.log("Telegram WebApp detected");try{let e=window.Telegram.WebApp;if(e&&e.initDataUnsafe&&e.initDataUnsafe.user){let r=e.initDataUnsafe.user;if(r&&r.id){let e=String(r.id);return console.log("Found Telegram user from WebApp:",e),e}}}catch(e){console.error("Error accessing Telegram WebApp data:",e)}let e=new URLSearchParams(window.location.search).get("tgWebAppData");if(e)try{let r=decodeURIComponent(e).match(/"id":(\d+)/);if(r&&r[1]){let e=r[1];return console.log("Found Telegram user from tgWebAppData:",e),e}}catch(e){console.error("Error parsing tgWebAppData:",e)}}{let e=new URLSearchParams(window.location.search),r=e.get("user_id")||e.get("id");if(r)return console.log("Found user_id in URL:",r),r;let t=window.location.hash,s=new URLSearchParams(t.substring(1)),n=s.get("user_id")||s.get("id");if(n)return console.log("Found user_id in hash:",n),n;let a=localStorage.getItem("telegram_user_id");if(a)return console.log("Found user_id in localStorage:",a),a}return console.warn("No Telegram user ID found. This should only happen in development."),null}catch(e){return console.error("Error getting Telegram user:",e),null}})();e?(c(e),localStorage.setItem("telegram_user_id",e),console.log("Set Telegram user ID:",e)):console.error("Failed to get a valid user ID")},[]);let{data:d,error:u,isLoading:m,mutate:h}=(0,a.ZP)(t?["user",t]:null,async e=>{let[r,t]=e;try{console.log("Fetching user data for ID:",t);let{data:e,error:r}=await l.O.from("users").select("*").eq("user_id",t).single();if(console.log("Existing user data:",e),r){if("PGRST116"===r.code){console.log("User not found, creating new user...");let{data:e,error:r}=await l.O.from("users").insert({user_id:t,telegram_id:t,balance:0,solana_balance:0,energy:1200,spin_energy:1200,last_spin_energy_reset:new Date().toISOString(),level:"1",is_admin:t===o,mining_equipment:{},mining_rate:0}).select().single();if(r)throw console.error("Error creating new user:",r),r;return console.log("New user created:",e),e}throw r}if(e&&!e.telegram_id){console.log("Updating user with telegram_id...");let{data:r,error:s}=await l.O.from("users").update({telegram_id:t}).eq("user_id",t).select().single();s?console.error("Error updating user telegram_id:",s):(console.log("User updated with telegram_id:",r),e.telegram_id=t)}if(e&&(void 0===e.spin_energy||null===e.spin_energy||0===e.spin_energy)){console.log("Updating user with spin energy...");let{data:e,error:r}=await l.O.from("users").update({spin_energy:1200,last_spin_energy_reset:new Date().toISOString()}).eq("user_id",t).select().single();if(r)throw console.error("Error updating user:",r),r;return console.log("User updated with spin energy:",e),e}if(e.last_spin_energy_reset){let r=new Date(e.last_spin_energy_reset),s=new Date;if((s.getTime()-r.getTime())/36e5>=12){console.log("Resetting spin energy after 12 hours...");let{data:e,error:r}=await l.O.from("users").update({spin_energy:1200,last_spin_energy_reset:s.toISOString()}).eq("user_id",t).select().single();if(r)throw console.error("Error resetting energy:",r),r;return console.log("Energy reset complete:",e),e}}if(!0===e.is_admin&&t!==o){console.log("Fixing incorrect admin status for user:",t);let{data:e,error:r}=await l.O.from("users").update({is_admin:t===o}).eq("user_id",t).select().single();if(r)console.error("Error fixing admin status:",r);else if(e)return console.log("Admin status fixed for user:",e),e}return e}catch(e){throw console.error("Error in user data fetching:",e),e}},{revalidateOnFocus:!1,revalidateOnReconnect:!1,refreshInterval:6e4}),f=async e=>{if(!d||!t)return console.error("Cannot update wallet address: User not logged in"),!1;try{let r=await fetch("/api/user/update-wallet",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:t,wallet_address:e})});if(!r.ok){let e=await r.json();return console.error("Failed to update wallet address:",e),!1}return await h(),!0}catch(e){return console.error("Error updating wallet address:",e),!1}};return(0,s.jsx)(i.Provider,{value:{user:d,loading:m,error:u,mutate:h,updateWalletAddress:f},children:r})}function d(){return(0,n.useContext)(i)}},4958:function(e,r,t){"use strict";t.d(r,{O:function(){return l}});var s=t(9377);let n="https://pkaooixolhnhdyajwlgw.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBrYW9vaXhvbGhuaGR5YWp3bGd3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzk5NDQzMDEsImV4cCI6MjA1NTUyMDMwMX0.ATOLcUZaP--eojDV0ugG0bujlOkzam0q7A6e9IIKnxY";if(!n||!a)throw Error("Missing Supabase credentials");let l=(0,s.eI)(n,a)}},function(e){e.O(0,[840,965,134,971,69,744],function(){return e(e.s=9266)}),_N_E=e.O()}]);