(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[50],{9213:function(e,s,t){Promise.resolve().then(t.bind(t,5344))},5344:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return p}});var a=t(3827),i=t(4090),l=t(7372),r=t(1840),n=t(6790),c=t(963),o=t(4775),d=t(703);let m=[{id:"hero",name:"Hero Musky",description:"Become a Hero Musky and enjoy enhanced mining and energy benefits",benefits:["2x Mining rate for 3 Days","50% energy boost for 3 days","Hero Musky badge","Profile image changes to HERO.png"],prices:{ton:1,stars:500},duration:"3 days",image:"/images/hero-musky.png"},{id:"superhero",name:"Superhero Musky",description:"Upgrade to Superhero Musky for maximum benefits",benefits:["4x Mining Rate for 3 Days","100% energy boost for 3 days","Superhero Musky badge","Profile image changes to SUPERHERO.png"],prices:{ton:2,stars:1e3},duration:"3 days",image:"/images/superhero-musky.png"}],h=[{id:"RTX4070",name:"RTX 4070 Miner",description:"Start mining with the RTX 4070",benefits:["Mines 0.03 Solana Per day","Lasts for 30 Days","Total collection: 0.9 Solana","Buy 2 to unlock RTX 4090"],prices:{ton:5,stars:2500},duration:"30 days",image:"/images/rtx4070.png"},{id:"RTX4090",name:"RTX 4090 Miner",description:"Upgrade to the powerful RTX 4090",benefits:["Mines 0.08 Solana Per day","Lasts for 30 Days","Total collection: 2.4 Solana","Buy 2 to unlock RTX 5070"],prices:{ton:9,stars:5e3},duration:"30 days",image:"/images/rtx4090.png"},{id:"RTX5070",name:"RTX 5070 Miner",description:"Advanced RTX 5070 mining hardware",benefits:["Mines 0.25 Solana Per day","Lasts for 30 Days","Total collection: 7.5 Solana","Buy 2 to unlock RTX 5090"],prices:{ton:25,stars:12500},duration:"30 days",image:"/images/rtx5070.png"},{id:"RTX5090",name:"RTX 5090 Miner",description:"Ultimate RTX 5090 mining hardware",benefits:["Mines 0.5 Solana Per day","Lasts for 30 Days","Total collection: 15 Solana","Maximum 2 purchases allowed"],prices:{ton:50,stars:25e3},duration:"30 days",image:"/images/rtx5090.png"}],x=[{id:"stamina",amount:1e3,price:100},{id:"stamina",amount:5e3,price:500},{id:"stamina",amount:1e4,price:1e3}],u=()=>{let{user:e,mutate:s}=(0,n.a)(),[t,l]=(0,i.useState)("upgrade"),[c,u]=(0,i.useState)(null),[p,g]=(0,i.useState)(null),[w,b]=(0,i.useState)(!1),[f,y]=(0,i.useState)("TON"),j=e=>{u(e),b(!0)},N=e=>{g(e),b(!0)},v=async()=>{await s(),b(!1),u(null),g(null)},S=()=>{b(!1)};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex space-x-4 mb-6",children:[(0,a.jsx)(r.E.button,{onClick:()=>l("upgrade"),className:"flex-1 py-3 rounded-xl font-bold ".concat("upgrade"===t?"bg-accent text-white":"bg-primary/20 text-white/60"),whileHover:{scale:1.02},whileTap:{scale:.98},children:"Upgrade Status"}),(0,a.jsx)(r.E.button,{onClick:()=>l("miner"),className:"flex-1 py-3 rounded-xl font-bold ".concat("miner"===t?"bg-accent text-white":"bg-primary/20 text-white/60"),whileHover:{scale:1.02},whileTap:{scale:.98},children:"Buy Miners"}),(0,a.jsx)(r.E.button,{onClick:()=>l("stamina"),className:"flex-1 py-3 rounded-xl font-bold ".concat("stamina"===t?"bg-accent text-white":"bg-primary/20 text-white/60"),whileHover:{scale:1.02},whileTap:{scale:.98},children:"Buy Stamina"})]}),"upgrade"===t&&!w&&(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:m.map(e=>(0,a.jsxs)(r.E.div,{className:"bg-primary/20 backdrop-blur-lg rounded-xl p-6 border border-white/10 hover:border-accent/50 transition-all",whileHover:{scale:1.02},initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[(0,a.jsxs)("div",{className:"flex items-center mb-4",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-accent/20 rounded-full flex items-center justify-center mr-4",children:e.image?(0,a.jsx)(d.default,{src:e.image,alt:e.name,width:48,height:48}):(0,a.jsx)("span",{className:"text-2xl",children:"\uD83D\uDC51"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-white",children:e.name}),(0,a.jsx)("p",{className:"text-white/60 text-sm",children:e.duration})]})]}),(0,a.jsx)("p",{className:"text-white/80 mb-4",children:e.description}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h4",{className:"text-white font-semibold mb-2",children:"Benefits:"}),(0,a.jsx)("ul",{className:"space-y-1",children:e.benefits.map((e,s)=>(0,a.jsxs)("li",{className:"text-white/70 text-sm flex items-center",children:[(0,a.jsx)("span",{className:"text-accent mr-2",children:"✓"})," ",e]},s))})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center mt-4",children:[(0,a.jsxs)("div",{className:"text-white",children:[(0,a.jsx)("span",{className:"text-white/60 text-sm",children:"Price: "}),(0,a.jsxs)("span",{className:"font-bold",children:[e.prices.ton," TON"]}),(0,a.jsx)("span",{className:"text-white/60 text-sm",children:" or "}),(0,a.jsxs)("span",{className:"font-bold",children:[e.prices.stars," Stars"]})]}),(0,a.jsx)(r.E.button,{onClick:()=>j(e),className:"px-4 py-2 bg-accent rounded-lg font-semibold text-white",whileHover:{scale:1.05},whileTap:{scale:.95},children:"Purchase"})]})]},e.id))}),"miner"===t&&!w&&(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:h.map(e=>(0,a.jsxs)(r.E.div,{className:"bg-primary/20 backdrop-blur-lg rounded-xl p-6 border border-white/10 hover:border-accent/50 transition-all",whileHover:{scale:1.02},initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[(0,a.jsxs)("div",{className:"flex items-center mb-4",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-accent/20 rounded-full flex items-center justify-center mr-4",children:e.image?(0,a.jsx)(d.default,{src:e.image,alt:e.name,width:48,height:48}):(0,a.jsx)("span",{className:"text-2xl",children:"⛏️"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-white",children:e.name}),(0,a.jsx)("p",{className:"text-white/60 text-sm",children:e.duration})]})]}),(0,a.jsx)("p",{className:"text-white/80 mb-4",children:e.description}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h4",{className:"text-white font-semibold mb-2",children:"Benefits:"}),(0,a.jsx)("ul",{className:"space-y-1",children:e.benefits.map((e,s)=>(0,a.jsxs)("li",{className:"text-white/70 text-sm flex items-center",children:[(0,a.jsx)("span",{className:"text-accent mr-2",children:"✓"})," ",e]},s))})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center mt-4",children:[(0,a.jsxs)("div",{className:"text-white",children:[(0,a.jsx)("span",{className:"text-white/60 text-sm",children:"Price: "}),(0,a.jsxs)("span",{className:"font-bold",children:[e.prices.ton," TON"]}),(0,a.jsx)("span",{className:"text-white/60 text-sm",children:" or "}),(0,a.jsxs)("span",{className:"font-bold",children:[e.prices.stars," Stars"]})]}),(0,a.jsx)(r.E.button,{onClick:()=>j(e),className:"px-4 py-2 bg-accent rounded-lg font-semibold text-white",whileHover:{scale:1.05},whileTap:{scale:.95},children:"Purchase"})]})]},e.id))}),"stamina"===t&&!w&&(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:x.map((e,s)=>(0,a.jsxs)(r.E.div,{className:"bg-primary/20 backdrop-blur-lg rounded-xl p-6 border border-white/10 hover:border-accent/50 transition-all",whileHover:{scale:1.02},initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[(0,a.jsxs)("div",{className:"flex flex-col items-center mb-4",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-accent/20 rounded-full flex items-center justify-center mb-2",children:(0,a.jsx)("span",{className:"text-2xl",children:"⚡"})}),(0,a.jsxs)("h3",{className:"text-lg font-bold text-white",children:[e.amount," Stamina"]})]}),(0,a.jsxs)("div",{className:"text-center mb-4",children:[(0,a.jsx)("p",{className:"text-white/80",children:"Boost your lucky spin energy"}),(0,a.jsx)("p",{className:"text-white/60 text-sm",children:"Resets every 12 hours"})]}),(0,a.jsx)("div",{className:"flex justify-center mt-4",children:(0,a.jsxs)(r.E.button,{onClick:()=>N(e),className:"px-4 py-2 bg-accent rounded-lg font-semibold text-white",whileHover:{scale:1.05},whileTap:{scale:.95},children:["Buy for ",e.price," Stars"]})})]},s))}),w&&c&&(0,a.jsx)(r.E.div,{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,a.jsxs)(r.E.div,{className:"bg-primary p-6 rounded-2xl w-full max-w-md",initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-white",children:"Confirm Purchase"}),(0,a.jsx)("button",{onClick:S,className:"text-white/60 hover:text-white",children:"✕"})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white mb-2",children:c.name}),(0,a.jsx)("p",{className:"text-white/70",children:c.description})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-white/70",children:"Item:"}),(0,a.jsx)("span",{className:"text-white font-semibold",children:c.name})]}),(0,a.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-white/70",children:"Duration:"}),(0,a.jsx)("span",{className:"text-white font-semibold",children:c.duration})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-white/70",children:"Price:"}),(0,a.jsx)("span",{className:"text-white font-semibold",children:"TON"===f?"".concat(c.prices.ton," TON"):"".concat(c.prices.stars," Stars")})]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("div",{className:"flex space-x-2 mb-4",children:[(0,a.jsx)(r.E.button,{onClick:()=>y("TON"),className:"flex-1 py-2 rounded-lg font-semibold ".concat("TON"===f?"bg-accent text-white":"bg-white/10 text-white/60"),whileHover:{scale:1.02},whileTap:{scale:.98},children:"Pay with TON"}),(0,a.jsx)(r.E.button,{onClick:()=>y("Stars"),className:"flex-1 py-2 rounded-lg font-semibold ".concat("Stars"===f?"bg-accent text-white":"bg-white/10 text-white/60"),whileHover:{scale:1.02},whileTap:{scale:.98},children:"Pay with Stars"})]}),(0,a.jsx)(o.Z,{amount:"TON"===f?c.prices.ton:c.prices.stars,currency:f,itemType:c.id,onSuccess:v,onCancel:S})]})]})}),w&&p&&(0,a.jsx)(r.E.div,{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,a.jsxs)(r.E.div,{className:"bg-primary p-6 rounded-2xl w-full max-w-md",initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-white",children:"Confirm Purchase"}),(0,a.jsx)("button",{onClick:S,className:"text-white/60 hover:text-white",children:"✕"})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-white mb-2",children:[p.amount," Stamina"]}),(0,a.jsx)("p",{className:"text-white/70",children:"Boost your lucky spin energy"})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-white/70",children:"Amount:"}),(0,a.jsxs)("span",{className:"text-white font-semibold",children:[p.amount," Stamina"]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-white/70",children:"Price:"}),(0,a.jsxs)("span",{className:"text-white font-semibold",children:[p.price," Stars"]})]})]}),(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)(o.Z,{amount:p.price,currency:"Stars",itemType:"stamina",onSuccess:v,onCancel:S})})]})})]})};function p(){var e,s,t;let{user:o,mutate:d}=(0,n.a)(),[m,h]=(0,i.useState)("payments"),[x,p]=(0,i.useState)(""),[g,w]=(0,i.useState)(""),[b,f]=(0,i.useState)((null==o?void 0:o.solana_address)||""),[y,j]=(0,i.useState)(!1),[N,v]=(0,i.useState)(""),[S,_]=(0,i.useState)(!1);(0,i.useEffect)(()=>{(null==o?void 0:o.solana_address)&&v(o.solana_address)},[null==o?void 0:o.solana_address]);let k=async()=>{if(!x||0>=parseFloat(x)){c.Am.error("Please enter a valid amount");return}j(!0);try{(await fetch("/api/stake",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:null==o?void 0:o.user_id,amount:parseFloat(x)})})).ok?(d(),p(""),c.Am.success("Successfully staked MUSKY")):c.Am.error("Failed to stake MUSKY")}catch(e){c.Am.error("Failed to stake MUSKY")}finally{j(!1)}},T=async()=>{if(!(null==o?void 0:o.solana_address)){c.Am.error("Please set your Solana wallet address first");return}let e=parseFloat(g);if(isNaN(e)||e<2){c.Am.error("Minimum withdrawal is 2 SOL");return}if(e>((null==o?void 0:o.solana_balance)||0)){c.Am.error("Insufficient SOL balance");return}j(!0);try{let s=await fetch("/api/withdraw/solana",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:null==o?void 0:o.user_id,amount:e,solana_address:o.solana_address,username:o.username||"Anonymous"})});if(s.ok)d(),w(""),c.Am.success("Withdrawal request sent to admin for approval");else{let e=await s.json();c.Am.error(e.error||"Failed to submit withdrawal request")}}catch(e){console.error("Withdrawal error:",e),c.Am.error("Failed to submit withdrawal request")}finally{j(!1)}},E=async()=>{if((null==o?void 0:o.user_id)&&N){_(!0);try{if(!(await fetch("/api/user/update-solana",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:o.user_id,solana_address:N})})).ok)throw Error("Failed to update Solana address");await d(),c.Am.success("Solana address updated successfully")}catch(e){console.error("Error updating Solana address:",e),c.Am.error("Failed to update Solana address")}finally{_(!1)}}};return(0,a.jsx)(l.Z,{children:(0,a.jsxs)("div",{className:"max-w-2xl mx-auto px-4",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-white",children:"Earn & Withdraw"}),(0,a.jsx)("p",{className:"text-white/60",children:"Purchase items, stake MUSKY and withdraw SOL"})]}),(0,a.jsxs)("div",{className:"flex space-x-4 mb-6",children:[(0,a.jsx)(r.E.button,{onClick:()=>h("payments"),className:"flex-1 py-3 rounded-xl font-bold ".concat("payments"===m?"bg-accent text-white":"bg-primary/20 text-white/60"),whileHover:{scale:1.02},whileTap:{scale:.98},children:"Purchase"}),(0,a.jsx)(r.E.button,{onClick:()=>h("stake"),className:"flex-1 py-3 rounded-xl font-bold ".concat("stake"===m?"bg-accent text-white":"bg-primary/20 text-white/60"),whileHover:{scale:1.02},whileTap:{scale:.98},children:"Stake"}),(0,a.jsx)(r.E.button,{onClick:()=>h("withdraw"),className:"flex-1 py-3 rounded-xl font-bold ".concat("withdraw"===m?"bg-accent text-white":"bg-primary/20 text-white/60"),whileHover:{scale:1.02},whileTap:{scale:.98},children:"Withdraw"})]}),"payments"===m&&(0,a.jsx)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:(0,a.jsx)(u,{})}),"stake"===m&&(0,a.jsx)("div",{className:"space-y-6",children:(0,a.jsxs)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-primary/20 backdrop-blur-lg rounded-xl p-6 border border-white/10",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:"Staking Benefits"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"bg-accent/10 rounded-lg p-4 text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-accent mb-2",children:"2x"}),(0,a.jsx)("div",{className:"text-white",children:"Mining Rate"})]}),(0,a.jsxs)("div",{className:"bg-accent/10 rounded-lg p-4 text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-accent mb-2",children:"50%"}),(0,a.jsx)("div",{className:"text-white",children:"Energy Boost"})]}),(0,a.jsxs)("div",{className:"bg-accent/10 rounded-lg p-4 text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-accent mb-2",children:"10%"}),(0,a.jsx)("div",{className:"text-white",children:"Referral Bonus"})]})]}),(0,a.jsxs)("div",{className:"mt-6 space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-white/80",children:"Available MUSKY:"}),(0,a.jsxs)("span",{className:"text-white font-bold",children:[null!==(s=null==o?void 0:o.balance)&&void 0!==s?s:0," MUSKY"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-white/80 mb-2",children:"Amount to Stake"}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("input",{type:"number",value:x,onChange:e=>p(e.target.value),placeholder:"Enter amount",className:"flex-1 bg-black/20 border border-white/10 rounded-lg px-4 py-2 text-white placeholder-white/40"}),(0,a.jsx)(r.E.button,{onClick:k,disabled:y,className:"px-4 py-2 bg-accent rounded-lg font-semibold text-white disabled:opacity-50",whileHover:{scale:1.02},whileTap:{scale:.98},children:"Stake"})]})]})]})]})}),"withdraw"===m&&(0,a.jsx)("div",{className:"space-y-6",children:(0,a.jsxs)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-primary/20 backdrop-blur-lg rounded-xl p-6 border border-white/10",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:"Withdraw SOL"}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("span",{className:"text-white/80",children:"Available SOL:"}),(0,a.jsxs)("span",{className:"text-white font-bold",children:[null!==(t=null==o?void 0:null===(e=o.solana_balance)||void 0===e?void 0:e.toFixed(4))&&void 0!==t?t:0," SOL"]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm text-white/80 mb-2",children:"Solana Wallet Address"}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("input",{type:"text",value:N,onChange:e=>v(e.target.value),placeholder:"Enter Solana address",className:"flex-1 bg-black/20 border border-white/10 rounded-lg px-4 py-2 text-white placeholder-white/40"}),(0,a.jsx)(r.E.button,{onClick:E,disabled:S||!N,className:"px-4 py-2 bg-accent rounded-lg font-semibold text-white disabled:opacity-50",whileHover:{scale:1.02},whileTap:{scale:.98},children:"Update"})]}),(0,a.jsx)("p",{className:"text-xs text-white/40 mt-1",children:"Make sure to enter a valid Solana address"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-white/80 mb-2",children:"Amount to Withdraw"}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("input",{type:"number",value:g,onChange:e=>w(e.target.value),placeholder:"Enter amount",className:"flex-1 bg-black/20 border border-white/10 rounded-lg px-4 py-2 text-white placeholder-white/40"}),(0,a.jsx)(r.E.button,{onClick:T,disabled:y||!(null==o?void 0:o.solana_address),className:"px-4 py-2 bg-accent rounded-lg font-semibold text-white disabled:opacity-50",whileHover:{scale:1.02},whileTap:{scale:.98},children:"Withdraw"})]}),(0,a.jsx)("p",{className:"text-xs text-white/40 mt-1",children:"Minimum withdrawal: 2 SOL"})]})]}),(0,a.jsxs)("div",{className:"bg-black/20 rounded-lg p-4",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-white mb-2",children:"Withdrawal Information"}),(0,a.jsxs)("ul",{className:"space-y-1 text-xs text-white/60",children:[(0,a.jsx)("li",{children:"• Withdrawals are processed manually within 24 hours"}),(0,a.jsx)("li",{children:"• Make sure your Solana address is correct"}),(0,a.jsx)("li",{children:"• Minimum withdrawal amount is 2 SOL"}),(0,a.jsx)("li",{children:"• You can only withdraw to your own wallet"})]})]})]})})]})})}},6790:function(e,s,t){"use strict";t.d(s,{a:function(){return d},d:function(){return o}});var a=t(3827),i=t(4090),l=t(7212),r=t(4958);let n=(0,i.createContext)({user:null,loading:!1,error:null,mutate:async()=>{},updateWalletAddress:async()=>!1}),c="7093793454";function o(e){let{children:s}=e,[t,o]=(0,i.useState)(null);(0,i.useEffect)(()=>{let e=(()=>{try{if(console.log("Attempting to get Telegram user ID..."),window.Telegram){console.log("Telegram WebApp detected");try{let e=window.Telegram.WebApp;if(e&&e.initDataUnsafe&&e.initDataUnsafe.user){let s=e.initDataUnsafe.user;if(s&&s.id){let e=String(s.id);return console.log("Found Telegram user from WebApp:",e),e}}}catch(e){console.error("Error accessing Telegram WebApp data:",e)}let e=new URLSearchParams(window.location.search).get("tgWebAppData");if(e)try{let s=decodeURIComponent(e).match(/"id":(\d+)/);if(s&&s[1]){let e=s[1];return console.log("Found Telegram user from tgWebAppData:",e),e}}catch(e){console.error("Error parsing tgWebAppData:",e)}}{let e=new URLSearchParams(window.location.search),s=e.get("user_id")||e.get("id");if(s)return console.log("Found user_id in URL:",s),s;let t=window.location.hash,a=new URLSearchParams(t.substring(1)),i=a.get("user_id")||a.get("id");if(i)return console.log("Found user_id in hash:",i),i;let l=localStorage.getItem("telegram_user_id");if(l)return console.log("Found user_id in localStorage:",l),l}return console.warn("No Telegram user ID found. This should only happen in development."),null}catch(e){return console.error("Error getting Telegram user:",e),null}})();e?(o(e),localStorage.setItem("telegram_user_id",e),console.log("Set Telegram user ID:",e)):console.error("Failed to get a valid user ID")},[]);let{data:d,error:m,isLoading:h,mutate:x}=(0,l.ZP)(t?["user",t]:null,async e=>{let[s,t]=e;try{console.log("Fetching user data for ID:",t);let{data:e,error:s}=await r.O.from("users").select("*").eq("user_id",t).single();if(console.log("Existing user data:",e),s){if("PGRST116"===s.code){console.log("User not found, creating new user...");let{data:e,error:s}=await r.O.from("users").insert({user_id:t,telegram_id:t,balance:0,solana_balance:0,energy:1200,spin_energy:1200,last_spin_energy_reset:new Date().toISOString(),level:"1",is_admin:t===c,mining_equipment:{},mining_rate:0}).select().single();if(s)throw console.error("Error creating new user:",s),s;return console.log("New user created:",e),e}throw s}if(e&&!e.telegram_id){console.log("Updating user with telegram_id...");let{data:s,error:a}=await r.O.from("users").update({telegram_id:t}).eq("user_id",t).select().single();a?console.error("Error updating user telegram_id:",a):(console.log("User updated with telegram_id:",s),e.telegram_id=t)}if(e&&(void 0===e.spin_energy||null===e.spin_energy||0===e.spin_energy)){console.log("Updating user with spin energy...");let{data:e,error:s}=await r.O.from("users").update({spin_energy:1200,last_spin_energy_reset:new Date().toISOString()}).eq("user_id",t).select().single();if(s)throw console.error("Error updating user:",s),s;return console.log("User updated with spin energy:",e),e}if(e.last_spin_energy_reset){let s=new Date(e.last_spin_energy_reset),a=new Date;if((a.getTime()-s.getTime())/36e5>=12){console.log("Resetting spin energy after 12 hours...");let{data:e,error:s}=await r.O.from("users").update({spin_energy:1200,last_spin_energy_reset:a.toISOString()}).eq("user_id",t).select().single();if(s)throw console.error("Error resetting energy:",s),s;return console.log("Energy reset complete:",e),e}}if(!0===e.is_admin&&t!==c){console.log("Fixing incorrect admin status for user:",t);let{data:e,error:s}=await r.O.from("users").update({is_admin:t===c}).eq("user_id",t).select().single();if(s)console.error("Error fixing admin status:",s);else if(e)return console.log("Admin status fixed for user:",e),e}return e}catch(e){throw console.error("Error in user data fetching:",e),e}},{revalidateOnFocus:!1,revalidateOnReconnect:!1,refreshInterval:6e4}),u=async e=>{if(!d||!t)return console.error("Cannot update wallet address: User not logged in"),!1;try{let s=await fetch("/api/user/update-wallet",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:t,wallet_address:e})});if(!s.ok){let e=await s.json();return console.error("Failed to update wallet address:",e),!1}return await x(),!0}catch(e){return console.error("Error updating wallet address:",e),!1}};return(0,a.jsx)(n.Provider,{value:{user:d,loading:h,error:m,mutate:x,updateWalletAddress:u},children:s})}function d(){return(0,i.useContext)(n)}},4958:function(e,s,t){"use strict";t.d(s,{O:function(){return r}});var a=t(9377);let i="https://pkaooixolhnhdyajwlgw.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBrYW9vaXhvbGhuaGR5YWp3bGd3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzk5NDQzMDEsImV4cCI6MjA1NTUyMDMwMX0.ATOLcUZaP--eojDV0ugG0bujlOkzam0q7A6e9IIKnxY";if(!i||!l)throw Error("Missing Supabase credentials");let r=(0,a.eI)(i,l)}},function(e){e.O(0,[840,965,134,906,971,69,744],function(){return e(e.s=9213)}),_N_E=e.O()}]);