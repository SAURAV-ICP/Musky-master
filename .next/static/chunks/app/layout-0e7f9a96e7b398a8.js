(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{8924:function(){},5024:function(){},8938:function(e,r,t){Promise.resolve().then(t.bind(t,8595))},8595:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return d}});var n=t(3827),o=t(9646),a=t.n(o);t(3385);var s=t(6790),i=t(1116);let l="".concat(window.location.protocol,"//").concat(window.location.host,"/tonconnect-manifest.json");function c(e){let{children:r}=e,t="".concat(window.location.protocol,"//").concat(window.location.host);return(0,n.jsx)(i.LD,{manifestUrl:l,actionsConfiguration:{twaReturnUrl:t,skipRedirectToWallet:"always"},children:r})}var u=t(963);function d(e){let{children:r}=e;return(0,n.jsxs)("html",{lang:"en",children:[(0,n.jsxs)("head",{children:[(0,n.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"}),(0,n.jsx)("meta",{name:"HandheldFriendly",content:"true"}),(0,n.jsx)("meta",{name:"apple-mobile-web-app-capable",content:"yes"}),(0,n.jsx)("meta",{name:"apple-mobile-web-app-status-bar-style",content:"black-translucent"})]}),(0,n.jsx)("body",{className:"".concat(a().className," overflow-x-hidden"),children:(0,n.jsx)(c,{children:(0,n.jsxs)(s.d,{children:[r,(0,n.jsx)(u.x7,{position:"bottom-center"})]})})})]})}},6790:function(e,r,t){"use strict";t.d(r,{a:function(){return u},d:function(){return c}});var n=t(3827),o=t(4090),a=t(7212),s=t(4958);let i=(0,o.createContext)({user:null,loading:!1,error:null,mutate:async()=>{},updateWalletAddress:async()=>!1}),l="7093793454";function c(e){let{children:r}=e,[t,c]=(0,o.useState)(null);(0,o.useEffect)(()=>{let e=(()=>{try{if(console.log("Attempting to get Telegram user ID..."),window.Telegram){console.log("Telegram WebApp detected");try{let e=window.Telegram.WebApp;if(e&&e.initDataUnsafe&&e.initDataUnsafe.user){let r=e.initDataUnsafe.user;if(r&&r.id){let e=String(r.id);return console.log("Found Telegram user from WebApp:",e),e}}}catch(e){console.error("Error accessing Telegram WebApp data:",e)}let e=new URLSearchParams(window.location.search).get("tgWebAppData");if(e)try{let r=decodeURIComponent(e).match(/"id":(\d+)/);if(r&&r[1]){let e=r[1];return console.log("Found Telegram user from tgWebAppData:",e),e}}catch(e){console.error("Error parsing tgWebAppData:",e)}}{let e=new URLSearchParams(window.location.search),r=e.get("user_id")||e.get("id");if(r)return console.log("Found user_id in URL:",r),r;let t=window.location.hash,n=new URLSearchParams(t.substring(1)),o=n.get("user_id")||n.get("id");if(o)return console.log("Found user_id in hash:",o),o;let a=localStorage.getItem("telegram_user_id");if(a)return console.log("Found user_id in localStorage:",a),a}return console.warn("No Telegram user ID found. This should only happen in development."),null}catch(e){return console.error("Error getting Telegram user:",e),null}})();e?(c(e),localStorage.setItem("telegram_user_id",e),console.log("Set Telegram user ID:",e)):console.error("Failed to get a valid user ID")},[]);let{data:u,error:d,isLoading:g,mutate:p}=(0,a.ZP)(t?["user",t]:null,async e=>{let[r,t]=e;try{console.log("Fetching user data for ID:",t);let{data:e,error:r}=await s.O.from("users").select("*").eq("user_id",t).single();if(console.log("Existing user data:",e),r){if("PGRST116"===r.code){console.log("User not found, creating new user...");let{data:e,error:r}=await s.O.from("users").insert({user_id:t,telegram_id:t,balance:0,solana_balance:0,energy:1200,spin_energy:1200,last_spin_energy_reset:new Date().toISOString(),level:"1",is_admin:t===l,mining_equipment:{},mining_rate:0}).select().single();if(r)throw console.error("Error creating new user:",r),r;return console.log("New user created:",e),e}throw r}if(e&&!e.telegram_id){console.log("Updating user with telegram_id...");let{data:r,error:n}=await s.O.from("users").update({telegram_id:t}).eq("user_id",t).select().single();n?console.error("Error updating user telegram_id:",n):(console.log("User updated with telegram_id:",r),e.telegram_id=t)}if(e&&(void 0===e.spin_energy||null===e.spin_energy||0===e.spin_energy)){console.log("Updating user with spin energy...");let{data:e,error:r}=await s.O.from("users").update({spin_energy:1200,last_spin_energy_reset:new Date().toISOString()}).eq("user_id",t).select().single();if(r)throw console.error("Error updating user:",r),r;return console.log("User updated with spin energy:",e),e}if(e.last_spin_energy_reset){let r=new Date(e.last_spin_energy_reset),n=new Date;if((n.getTime()-r.getTime())/36e5>=12){console.log("Resetting spin energy after 12 hours...");let{data:e,error:r}=await s.O.from("users").update({spin_energy:1200,last_spin_energy_reset:n.toISOString()}).eq("user_id",t).select().single();if(r)throw console.error("Error resetting energy:",r),r;return console.log("Energy reset complete:",e),e}}if(!0===e.is_admin&&t!==l){console.log("Fixing incorrect admin status for user:",t);let{data:e,error:r}=await s.O.from("users").update({is_admin:t===l}).eq("user_id",t).select().single();if(r)console.error("Error fixing admin status:",r);else if(e)return console.log("Admin status fixed for user:",e),e}return e}catch(e){throw console.error("Error in user data fetching:",e),e}},{revalidateOnFocus:!1,revalidateOnReconnect:!1,refreshInterval:6e4}),m=async e=>{if(!u||!t)return console.error("Cannot update wallet address: User not logged in"),!1;try{let r=await fetch("/api/user/update-wallet",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:t,wallet_address:e})});if(!r.ok){let e=await r.json();return console.error("Failed to update wallet address:",e),!1}return await p(),!0}catch(e){return console.error("Error updating wallet address:",e),!1}};return(0,n.jsx)(i.Provider,{value:{user:u,loading:g,error:d,mutate:p,updateWalletAddress:m},children:r})}function u(){return(0,o.useContext)(i)}},4958:function(e,r,t){"use strict";t.d(r,{O:function(){return s}});var n=t(9377);let o="https://pkaooixolhnhdyajwlgw.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBrYW9vaXhvbGhuaGR5YWp3bGd3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzk5NDQzMDEsImV4cCI6MjA1NTUyMDMwMX0.ATOLcUZaP--eojDV0ugG0bujlOkzam0q7A6e9IIKnxY";if(!o||!a)throw Error("Missing Supabase credentials");let s=(0,n.eI)(o,a)},3385:function(){},9646:function(e){e.exports={style:{fontFamily:"'__Inter_d65c78', '__Inter_Fallback_d65c78'",fontStyle:"normal"},className:"__className_d65c78"}}},function(e){e.O(0,[896,965,522,971,69,744],function(){return e(e.s=8938)}),_N_E=e.O()}]);