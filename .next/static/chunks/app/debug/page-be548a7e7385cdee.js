(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[670],{3517:function(e,r,s){Promise.resolve().then(s.bind(s,2871))},2871:function(e,r,s){"use strict";s.r(r),s.d(r,{default:function(){return o}});var t=s(3827),n=s(4090),a=s(7372),i=s(6790),l=s(963);function o(){let{user:e,loading:r,error:s,mutate:o}=(0,i.a)(),[d,c]=(0,n.useState)(null),[u,m]=(0,n.useState)(!1),[g,h]=(0,n.useState)("");(0,n.useEffect)(()=>{(null==e?void 0:e.user_id)&&x(e.user_id)},[e]);let x=async e=>{try{var r;m(!0);let s=await fetch("/api/debug/user?user_id=".concat(e)),t=await s.json();c(t),(null===(r=t.adminCheck)||void 0===r?void 0:r.adminId)&&h(t.adminCheck.adminId)}catch(e){console.error("Error fetching debug data:",e),l.Am.error("Failed to fetch debug data")}finally{m(!1)}},p=async()=>{if(null==e?void 0:e.user_id)try{m(!0),l.Am.loading("Fixing admin status...");let r=await fetch("/api/admin/fix-status",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:e.user_id,is_admin:e.user_id===g})});if(r.ok)l.Am.dismiss(),l.Am.success("Admin status fixed successfully"),o(),x(e.user_id);else{let e=await r.json();l.Am.dismiss(),l.Am.error("Failed to fix admin status: ".concat(e.error||"Unknown error"))}}catch(e){console.error("Error fixing admin status:",e),l.Am.dismiss(),l.Am.error("Failed to fix admin status")}finally{m(!1)}};return(0,t.jsx)(a.Z,{children:(0,t.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"User Debug Information"}),r?(0,t.jsx)("div",{className:"text-center py-8",children:(0,t.jsx)("p",{className:"text-lg",children:"Loading user data..."})}):s?(0,t.jsxs)("div",{className:"bg-red-500/20 p-4 rounded-lg mb-6",children:[(0,t.jsx)("h2",{className:"text-xl font-bold mb-2",children:"Error Loading User"}),(0,t.jsx)("p",{children:String(s)})]}):e?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"bg-primary-dark p-6 rounded-xl mb-6",children:[(0,t.jsx)("h2",{className:"text-xl font-bold mb-4",children:"User Information"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"bg-black/20 p-4 rounded-lg",children:[(0,t.jsx)("p",{className:"text-sm text-white/60",children:"User ID:"}),(0,t.jsx)("p",{className:"font-mono",children:e.user_id})]}),(0,t.jsxs)("div",{className:"bg-black/20 p-4 rounded-lg",children:[(0,t.jsx)("p",{className:"text-sm text-white/60",children:"Admin Status:"}),(0,t.jsx)("p",{className:"font-bold ".concat(e.is_admin?"text-green-500":"text-red-500"),children:e.is_admin?"Admin":"Regular User"})]}),(0,t.jsxs)("div",{className:"bg-black/20 p-4 rounded-lg",children:[(0,t.jsx)("p",{className:"text-sm text-white/60",children:"MUSKY Balance:"}),(0,t.jsx)("p",{className:"font-bold",children:e.balance.toLocaleString()})]}),(0,t.jsxs)("div",{className:"bg-black/20 p-4 rounded-lg",children:[(0,t.jsx)("p",{className:"text-sm text-white/60",children:"Solana Balance:"}),(0,t.jsxs)("p",{className:"font-bold",children:[e.solana_balance.toLocaleString()," SOL"]})]})]})]}),d&&(0,t.jsxs)("div",{className:"bg-primary-dark p-6 rounded-xl mb-6",children:[(0,t.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Admin Check"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,t.jsxs)("div",{className:"bg-black/20 p-4 rounded-lg",children:[(0,t.jsx)("p",{className:"text-sm text-white/60",children:"Is Admin Flag:"}),(0,t.jsx)("p",{className:"font-bold ".concat(d.adminCheck.isAdmin?"text-green-500":"text-red-500"),children:d.adminCheck.isAdmin?"True":"False"})]}),(0,t.jsxs)("div",{className:"bg-black/20 p-4 rounded-lg",children:[(0,t.jsx)("p",{className:"text-sm text-white/60",children:"Admin ID Match:"}),(0,t.jsx)("p",{className:"font-bold ".concat(d.adminCheck.isAdminId?"text-green-500":"text-red-500"),children:d.adminCheck.isAdminId?"True":"False"})]}),(0,t.jsxs)("div",{className:"bg-black/20 p-4 rounded-lg",children:[(0,t.jsx)("p",{className:"text-sm text-white/60",children:"Admin ID:"}),(0,t.jsx)("p",{className:"font-mono",children:d.adminCheck.adminId})]}),(0,t.jsxs)("div",{className:"bg-black/20 p-4 rounded-lg",children:[(0,t.jsx)("p",{className:"text-sm text-white/60",children:"Environment:"}),(0,t.jsx)("p",{className:"font-mono",children:d.environment.nodeEnv})]})]}),(0,t.jsxs)("div",{className:"mt-6",children:[(0,t.jsx)("h3",{className:"text-lg font-bold mb-2",children:"Fix Admin Status"}),(0,t.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,t.jsx)("input",{type:"text",value:g,onChange:e=>h(e.target.value),placeholder:"Admin ID",className:"bg-black/20 p-3 rounded-lg flex-grow"}),(0,t.jsx)("button",{onClick:p,disabled:u,className:"bg-orange-500 hover:bg-orange-400 py-3 px-6 rounded-lg font-bold disabled:opacity-50",children:u?"Processing...":"Fix Admin Status"})]}),(0,t.jsx)("p",{className:"text-sm text-white/60 mt-2",children:"This will update your admin status based on whether your user ID matches the admin ID."})]})]}),(0,t.jsxs)("div",{className:"bg-primary-dark p-6 rounded-xl",children:[(0,t.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Troubleshooting"}),(0,t.jsxs)("ul",{className:"list-disc list-inside space-y-2",children:[(0,t.jsx)("li",{children:"Make sure your Telegram Mini App is properly configured"}),(0,t.jsx)("li",{children:"Check that the NEXT_PUBLIC_ADMIN_ID environment variable is set correctly"}),(0,t.jsx)("li",{children:"Verify that your user ID matches the admin ID if you should be an admin"}),(0,t.jsx)("li",{children:"Try refreshing the page or logging out and back in"})]}),(0,t.jsx)("div",{className:"mt-6",children:(0,t.jsx)("button",{onClick:()=>{(null==e?void 0:e.user_id)&&x(e.user_id),o()},disabled:u,className:"bg-blue-500 hover:bg-blue-400 py-3 px-6 rounded-lg font-bold disabled:opacity-50",children:u?"Refreshing...":"Refresh Data"})})]})]}):(0,t.jsxs)("div",{className:"bg-yellow-500/20 p-4 rounded-lg mb-6",children:[(0,t.jsx)("h2",{className:"text-xl font-bold mb-2",children:"No User Found"}),(0,t.jsx)("p",{children:"You are not currently logged in or your user data could not be loaded."})]})]})})}},7372:function(e,r,s){"use strict";s.d(r,{Z:function(){return o}});var t=s(3827);s(4090);var n=s(8792),a=s(703),i=s(1840),l=s(7907);function o(e){let{children:r}=e,s=(0,l.usePathname)(),o=[{href:"/",label:"Home",icon:"\uD83C\uDFE0"},{href:"/tasks",label:"Tasks",icon:(0,t.jsx)(a.default,{src:"/components/assets/TASKS.png",width:24,height:24,alt:"Tasks"})},{href:"/mining",label:"Mining",icon:"⛏️"},{href:"/refer",label:"Refer",icon:"\uD83D\uDC65"},{href:"/earn",label:"Earn",icon:"\uD83D\uDCB0"}];return(0,t.jsx)("div",{className:"min-h-screen",children:(0,t.jsxs)(i.E.div,{className:"min-h-screen bg-gradient-to-b from-background-start-rgb to-background-end-rgb",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[(0,t.jsx)("main",{className:"container mx-auto px-4 py-8 pb-20",children:(0,t.jsx)(i.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:r})}),(0,t.jsx)(i.E.nav,{className:"fixed bottom-0 left-0 right-0 bg-white/10 backdrop-blur-lg border-t border-white/20",initial:{y:100},animate:{y:0},transition:{duration:.5},children:(0,t.jsx)("div",{className:"container mx-auto px-4",children:(0,t.jsx)("div",{className:"flex justify-between items-center py-2",children:o.map(e=>(0,t.jsxs)(n.default,{href:e.href,className:"relative flex flex-col items-center p-2 group",children:[(0,t.jsx)(i.E.span,{className:"text-2xl transition-transform duration-200 ".concat(s===e.href?"scale-110":"scale-100"),whileHover:{scale:1.1},whileTap:{scale:.9},children:e.icon}),(0,t.jsx)("span",{className:"text-xs mt-1 ".concat(s===e.href?"text-white font-bold":"text-white/60"),children:e.label}),s===e.href&&(0,t.jsx)(i.E.div,{className:"absolute -bottom-2 w-12 h-1 bg-accent rounded-full",layoutId:"activeTab",transition:{type:"spring",bounce:.2}})]},e.href))})})})]})})}},6790:function(e,r,s){"use strict";s.d(r,{a:function(){return c},d:function(){return d}});var t=s(3827),n=s(4090),a=s(7212),i=s(4958);let l=(0,n.createContext)({user:null,loading:!1,error:null,mutate:async()=>{},updateWalletAddress:async()=>!1}),o="7093793454";function d(e){let{children:r}=e,[s,d]=(0,n.useState)(null);(0,n.useEffect)(()=>{let e=(()=>{try{if(console.log("Attempting to get Telegram user ID..."),window.Telegram){console.log("Telegram WebApp detected");try{let e=window.Telegram.WebApp;if(e&&e.initDataUnsafe&&e.initDataUnsafe.user){let r=e.initDataUnsafe.user;if(r&&r.id){let e=String(r.id);return console.log("Found Telegram user from WebApp:",e),e}}}catch(e){console.error("Error accessing Telegram WebApp data:",e)}let e=new URLSearchParams(window.location.search).get("tgWebAppData");if(e)try{let r=decodeURIComponent(e).match(/"id":(\d+)/);if(r&&r[1]){let e=r[1];return console.log("Found Telegram user from tgWebAppData:",e),e}}catch(e){console.error("Error parsing tgWebAppData:",e)}}{let e=new URLSearchParams(window.location.search),r=e.get("user_id")||e.get("id");if(r)return console.log("Found user_id in URL:",r),r;let s=window.location.hash,t=new URLSearchParams(s.substring(1)),n=t.get("user_id")||t.get("id");if(n)return console.log("Found user_id in hash:",n),n;let a=localStorage.getItem("telegram_user_id");if(a)return console.log("Found user_id in localStorage:",a),a}return console.warn("No Telegram user ID found. This should only happen in development."),null}catch(e){return console.error("Error getting Telegram user:",e),null}})();e?(d(e),localStorage.setItem("telegram_user_id",e),console.log("Set Telegram user ID:",e)):console.error("Failed to get a valid user ID")},[]);let{data:c,error:u,isLoading:m,mutate:g}=(0,a.ZP)(s?["user",s]:null,async e=>{let[r,s]=e;try{console.log("Fetching user data for ID:",s);let{data:e,error:r}=await i.O.from("users").select("*").eq("user_id",s).single();if(console.log("Existing user data:",e),r){if("PGRST116"===r.code){console.log("User not found, creating new user...");let{data:e,error:r}=await i.O.from("users").insert({user_id:s,telegram_id:s,balance:0,solana_balance:0,energy:1200,spin_energy:1200,last_spin_energy_reset:new Date().toISOString(),level:"1",is_admin:s===o,mining_equipment:{},mining_rate:0}).select().single();if(r)throw console.error("Error creating new user:",r),r;return console.log("New user created:",e),e}throw r}if(e&&!e.telegram_id){console.log("Updating user with telegram_id...");let{data:r,error:t}=await i.O.from("users").update({telegram_id:s}).eq("user_id",s).select().single();t?console.error("Error updating user telegram_id:",t):(console.log("User updated with telegram_id:",r),e.telegram_id=s)}if(e&&(void 0===e.spin_energy||null===e.spin_energy||0===e.spin_energy)){console.log("Updating user with spin energy...");let{data:e,error:r}=await i.O.from("users").update({spin_energy:1200,last_spin_energy_reset:new Date().toISOString()}).eq("user_id",s).select().single();if(r)throw console.error("Error updating user:",r),r;return console.log("User updated with spin energy:",e),e}if(e.last_spin_energy_reset){let r=new Date(e.last_spin_energy_reset),t=new Date;if((t.getTime()-r.getTime())/36e5>=12){console.log("Resetting spin energy after 12 hours...");let{data:e,error:r}=await i.O.from("users").update({spin_energy:1200,last_spin_energy_reset:t.toISOString()}).eq("user_id",s).select().single();if(r)throw console.error("Error resetting energy:",r),r;return console.log("Energy reset complete:",e),e}}if(!0===e.is_admin&&s!==o){console.log("Fixing incorrect admin status for user:",s);let{data:e,error:r}=await i.O.from("users").update({is_admin:s===o}).eq("user_id",s).select().single();if(r)console.error("Error fixing admin status:",r);else if(e)return console.log("Admin status fixed for user:",e),e}return e}catch(e){throw console.error("Error in user data fetching:",e),e}},{revalidateOnFocus:!1,revalidateOnReconnect:!1,refreshInterval:6e4}),h=async e=>{if(!c||!s)return console.error("Cannot update wallet address: User not logged in"),!1;try{let r=await fetch("/api/user/update-wallet",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:s,wallet_address:e})});if(!r.ok){let e=await r.json();return console.error("Failed to update wallet address:",e),!1}return await g(),!0}catch(e){return console.error("Error updating wallet address:",e),!1}};return(0,t.jsx)(l.Provider,{value:{user:c,loading:m,error:u,mutate:g,updateWalletAddress:h},children:r})}function c(){return(0,n.useContext)(l)}},4958:function(e,r,s){"use strict";s.d(r,{O:function(){return i}});var t=s(9377);let n="https://pkaooixolhnhdyajwlgw.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBrYW9vaXhvbGhuaGR5YWp3bGd3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzk5NDQzMDEsImV4cCI6MjA1NTUyMDMwMX0.ATOLcUZaP--eojDV0ugG0bujlOkzam0q7A6e9IIKnxY";if(!n||!a)throw Error("Missing Supabase credentials");let i=(0,t.eI)(n,a)}},function(e){e.O(0,[840,965,134,971,69,744],function(){return e(e.s=3517)}),_N_E=e.O()}]);